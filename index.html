<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏û‡∏£‡∏£‡∏Ñ‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô‡∏ò‡∏£‡∏£‡∏° - ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (Pre-Register)</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏° Chart.js ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≤‡∏ü -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link
        href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&family=Sarabun:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="icon" href="data:,">

    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #fcfbf9;
            color: #4e342e;
        }

        h1,
        h2,
        h3,
        .font-head {
            font-family: 'Prompt', sans-serif;
        }

        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        th.sortable {
            cursor: pointer;
            transition: background-color 0.2s;
            user-select: none;
        }

        th.sortable:hover {
            background-color: #f3f4f6;
            color: #ea580c;
        }

        .checkbox-wrapper input:checked+div {
            background-color: #16a34a;
            border-color: #16a34a;
        }

        .checkbox-wrapper input:checked+div svg {
            display: block;
        }

        .password-container {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #9ca3af;
            z-index: 10;
        }

        .password-toggle:hover {
            color: #ea580c;
        }

        .aspect-video {
            aspect-ratio: 16 / 9;
        }

        .action-btn {
            z-index: 20;
            position: relative;
        }

        /* Custom Scrollbar for Reader */
        .reader-scroll::-webkit-scrollbar {
            width: 8px;
        }

        .reader-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .reader-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .reader-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Comments Section */
        .comment-bubble {
            background-color: #f3f4f6;
            border-radius: 1rem;
            border-top-left-radius: 0;
            padding: 0.75rem;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Chart Container Styling */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
    </style>
</head>

<body class="flex flex-col min-h-screen">

    <!-- NAV -->
    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-2 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" onclick="switchView('landing')">
                <img src="https://firebasestorage.googleapis.com/v0/b/susanonline-9ccbb.firebasestorage.app/o/pak%2Flogopak.png?alt=media&token=30557e25-5d5a-46f8-be24-babeaf095fad"
                    class="w-12 h-12 object-contain drop-shadow-sm hover:scale-105 transition-transform">
                <div class="hidden sm:block">
                    <h1 class="text-xl font-bold text-gray-800 font-head leading-none">‡∏û‡∏£‡∏£‡∏Ñ‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô‡∏ò‡∏£‡∏£‡∏°</h1>
                    <p class="text-[10px] text-gray-500 tracking-wider mt-1">THE LAND OF DHARMA PARTY</p>
                </div>
            </div>

            <div class="flex items-center gap-3">
                <button onclick="switchView('landing')"
                    class="text-gray-600 hover:text-orange-600 font-bold text-sm hidden md:block action-btn">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
                <div id="nav-guest">
                    <button onclick="switchView('auth')"
                        class="bg-orange-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-orange-700 transition shadow-md flex items-center gap-2 action-btn">
                        <i class="fa-solid fa-right-to-bracket"></i> <span>‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
                    </button>
                </div>
                <div id="nav-user" class="hidden flex gap-2 items-center">
                    <button onclick="switchView('member-center')"
                        class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-blue-700 transition shadow-md flex items-center gap-2 action-btn">
                        <i class="fa-solid fa-hand-holding-heart"></i> <span class="hidden sm:inline">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span>
                    </button>
                    <button onclick="switchView('dashboard')"
                        class="bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-green-700 transition shadow-md flex items-center gap-2 action-btn">
                        <i class="fa-solid fa-database"></i> <span class="hidden sm:inline">‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                    </button>
                    <button onclick="handleLogout()"
                        class="bg-gray-100 w-10 h-10 rounded-full hover:bg-red-50 hover:text-red-500 transition flex items-center justify-center shadow-sm action-btn"
                        title="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö">
                        <i class="fa-solid fa-power-off"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- LANDING PAGE -->
    <div id="view-landing" class="flex-grow fade-in">
        <header class="relative bg-gradient-to-b from-orange-50 via-white to-white pt-16 pb-16 overflow-hidden">
            <div class="container mx-auto px-4 text-center relative z-10">
                <img src="https://firebasestorage.googleapis.com/v0/b/susanonline-9ccbb.firebasestorage.app/o/pak%2Flogopak.png?alt=media&token=30557e25-5d5a-46f8-be24-babeaf095fad"
                    class="w-32 h-32 mx-auto mb-6 drop-shadow-xl animate-pulse">
                <h1 class="text-4xl md:text-6xl font-bold mb-6 text-gray-900 font-head leading-tight">
                    ‡∏û‡∏£‡∏£‡∏Ñ<span class="text-orange-600">‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô‡∏ò‡∏£‡∏£‡∏°</span><br>‡∏®‡∏µ‡∏•‡∏ò‡∏£‡∏£‡∏° <span
                        class="text-blue-700">‡∏ô‡∏≥‡∏ä‡∏≤‡∏ï‡∏¥</span>
                </h1>
                <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto mb-10 leading-relaxed">
                    "‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡∏û‡∏£‡∏∞‡∏û‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ô‡∏≤ ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏ò‡∏£‡∏£‡∏°<br>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏™‡∏∏‡∏Ç‡∏Ç‡∏≠‡∏á‡∏õ‡∏ß‡∏á‡∏ä‡∏ô"
                </p>
                <div
                    class="bg-yellow-50 border border-yellow-200 text-yellow-800 px-4 py-2 rounded-lg inline-block text-sm mb-6">
                    <i class="fa-solid fa-circle-info mr-1"></i>
                    ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö ‡∏Å‡∏Å‡∏ï.
                </div>
            </div>
        </header>

        <!-- INFOGRAPHIC CONTENT -->
        <div class="container mx-auto px-4 py-4 max-w-6xl space-y-16">

            <!-- Intro Section: Identity & Radar -->
            <section class="bg-white rounded-2xl shadow-md p-6 md:p-8 border-t-4 border-orange-500">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-4 font-head">
                            ‡∏à‡∏∏‡∏î‡∏¢‡∏∑‡∏ô‡∏ó‡∏≤‡∏á‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
                        </h2>
                        <p class="text-lg text-gray-600 mb-6 leading-relaxed">
                            ‡πÄ‡∏£‡∏≤‡∏Ñ‡∏∑‡∏≠‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ú‡∏™‡∏°‡∏ú‡∏™‡∏≤‡∏ô <strong>"‡∏´‡∏•‡∏±‡∏Å‡∏ò‡∏£‡∏£‡∏°"</strong>
                            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏¢‡πÉ‡∏´‡∏°‡πà
                            ‡πÇ‡∏î‡∏¢‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡∏û‡∏£‡∏∞‡∏û‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ô‡∏≤‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏õ‡∏≤‡∏Å‡∏ó‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£
                        </p>
                        <div class="bg-orange-50 p-4 rounded-xl border-l-4 border-orange-500 mb-4">
                            <h4 class="font-bold text-orange-800 font-head">‡∏Ñ‡πà‡∏≤‡∏ô‡∏¥‡∏¢‡∏°‡∏´‡∏•‡∏±‡∏Å</h4>
                            <p class="text-sm text-gray-600">‡∏ã‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏¢‡πå ‡∏™‡∏∏‡∏à‡∏£‡∏¥‡∏ï ‡∏¢‡∏∂‡∏î‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏ô‡∏ò‡∏£‡∏£‡∏° ‡∏Å‡∏•‡πâ‡∏≤‡∏´‡∏≤‡∏ç‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ó‡∏≥‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                            </p>
                        </div>
                    </div>
                    <!-- Chart: Party Focus Radar -->
                    <div class="flex flex-col items-center">
                        <div class="chart-container">
                            <canvas id="ideologyChart"></canvas>
                        </div>
                        <p class="text-center text-sm text-gray-400 mt-2">‡πÅ‡∏ú‡∏ô‡∏†‡∏≤‡∏û‡πÅ‡∏™‡∏î‡∏á‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢</p>
                    </div>
                </div>
            </section>

            <!-- Section: Religious & Ethical Policies -->
            <section
                class="bg-gradient-to-br from-orange-50 to-white rounded-2xl shadow-md p-6 md:p-8 border-l-4 border-orange-500">
                <div class="flex items-center mb-6">
                    <i class="fa-solid fa-vihara text-4xl text-orange-500 mr-3"></i>
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-800 font-head">‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏®‡∏≤‡∏™‡∏ô‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏±‡∏á‡∏Ñ‡∏°</h2>
                </div>
                <p class="text-gray-700 mb-8 max-w-3xl">
                    ‡∏ú‡∏•‡∏±‡∏Å‡∏î‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏û‡∏£‡∏∞‡∏û‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ô‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏®‡∏≤‡∏™‡∏ô‡∏≤‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏≤‡∏ï‡∏¥ ‡∏à‡∏±‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏û‡∏∏‡∏ó‡∏ò ‡πÅ‡∏•‡∏∞‡∏õ‡∏è‡∏¥‡∏£‡∏π‡∏õ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ò‡∏£‡∏£‡∏°
                </p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Viz: Monk Salary Increase -->
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                        <h3 class="font-bold text-lg text-gray-800 mb-2 border-b pb-2 font-head">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡∏£‡∏∞‡∏™‡∏á‡∏Ü‡πå</h3>
                        <p class="text-sm text-gray-500 mb-4 h-10">‡πÄ‡∏û‡∏¥‡πà‡∏° "‡∏Ñ‡πà‡∏≤‡∏ô‡∏¥‡∏ï‡∏¢‡∏†‡∏±‡∏ï" (‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏û‡∏£‡∏∞‡∏™‡∏±‡∏á‡∏Ü‡∏≤‡∏ò‡∏¥‡∏Å‡∏≤‡∏£)
                            ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô</p>
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="monkSalaryChart"></canvas>
                        </div>
                    </div>

                    <!-- Viz: Social Security Reform -->
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                        <h3 class="font-bold text-lg text-gray-800 mb-2 border-b pb-2 font-head">‡∏•‡∏î‡∏†‡∏≤‡∏£‡∏∞‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</h3>
                        <p class="text-sm text-gray-500 mb-4 h-10">‡∏•‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏°‡∏ó‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏° ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 1% ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á
                        </p>
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="socialSecurityChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-orange-600 text-white p-4 rounded-lg shadow text-center">
                        <i class="fa-solid fa-scroll text-2xl mb-2"></i>
                        <div class="font-bold font-head">‡∏®‡∏≤‡∏™‡∏ô‡∏≤‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏≤‡∏ï‡∏¥</div>
                        <div class="text-xs opacity-90">‡∏ö‡∏£‡∏£‡∏à‡∏∏‡πÉ‡∏ô‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç</div>
                    </div>
                    <div class="bg-blue-600 text-white p-4 rounded-lg shadow text-center">
                        <i class="fa-solid fa-building-columns text-2xl mb-2"></i>
                        <div class="font-bold font-head">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏û‡∏∏‡∏ó‡∏ò</div>
                        <div class="text-xs opacity-90">‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ß‡∏¥‡∏ñ‡∏µ‡∏û‡∏∏‡∏ó‡∏ò</div>
                    </div>
                    <div class="bg-green-600 text-white p-4 rounded-lg shadow text-center">
                        <i class="fa-solid fa-ban text-2xl mb-2"></i>
                        <div class="font-bold font-head">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏´‡∏≤‡∏£</div>
                        <div class="text-xs opacity-90">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏à</div>
                    </div>
                </div>
            </section>

            <!-- Section: Economy & Farmers -->
            <section
                class="bg-gradient-to-br from-green-50 to-white rounded-2xl shadow-md p-6 md:p-8 border-l-4 border-green-500">
                <div class="flex items-center mb-6">
                    <i class="fa-solid fa-seedling text-4xl text-green-600 mr-3"></i>
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-800 font-head">‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à‡∏£‡∏≤‡∏Å‡∏´‡∏ç‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- HTML Diagram: New Ministries -->
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100 relative overflow-hidden">
                        <h3 class="font-bold text-xl text-gray-800 mb-4 font-head">‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏Ñ‡∏£‡∏±‡∏ê</h3>
                        <div class="space-y-4">
                            <div class="flex items-center p-3 bg-green-50 rounded-lg border-l-4 border-green-500">
                                <i class="fa-solid fa-wheat-awn text-2xl text-green-600 mr-4"></i>
                                <div>
                                    <h4 class="font-bold text-gray-800">‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏ä‡∏≤‡∏ß‡∏ô‡∏≤</h4>
                                    <p class="text-xs text-gray-500">‡∏î‡∏π‡πÅ‡∏•‡∏ä‡∏≤‡∏ß‡∏ô‡∏≤‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤</p>
                                </div>
                            </div>
                            <div class="flex items-center p-3 bg-green-50 rounded-lg border-l-4 border-green-600">
                                <i class="fa-solid fa-tree text-2xl text-green-700 mr-4"></i>
                                <div>
                                    <h4 class="font-bold text-gray-800">‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏¢‡∏≤‡∏á‡∏û‡∏≤‡∏£‡∏≤</h4>
                                    <p class="text-xs text-gray-500">‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏Ñ‡∏≤‡∏¢‡∏≤‡∏á‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- HTML Diagram: Mega Projects -->
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100 relative overflow-hidden">
                        <h3 class="font-bold text-xl text-gray-800 mb-4 font-head">‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à‡∏û‡∏¥‡πÄ‡∏®‡∏©</h3>
                        <div class="grid grid-cols-1 gap-4">
                            <div class="flex items-center p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                                <i class="fa-solid fa-ship text-2xl text-blue-600 mr-4"></i>
                                <div>
                                    <h4 class="font-bold text-gray-800">‡∏Ç‡∏∏‡∏î "‡∏Ñ‡∏•‡∏≠‡∏á‡πÑ‡∏ó‡∏¢"</h4>
                                    <p class="text-xs text-gray-500">‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏£‡∏∑‡∏≠‡∏™‡∏°‡∏∏‡∏ó‡∏£ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏°‡∏´‡∏≤‡∏®‡∏≤‡∏•</p>
                                </div>
                            </div>
                            <div class="flex items-center p-3 bg-yellow-50 rounded-lg border-l-4 border-yellow-500">
                                <i class="fa-solid fa-solar-panel text-2xl text-yellow-600 mr-4"></i>
                                <div>
                                    <h4 class="font-bold text-gray-800">‡πÇ‡∏ã‡∏•‡πà‡∏≤‡πÄ‡∏ã‡∏•‡∏•‡πå‡πÄ‡∏™‡∏£‡∏µ</h4>
                                    <p class="text-xs text-gray-500">‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section: Education & Structure -->
            <section class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Education Column -->
                <div class="md:col-span-2 bg-white rounded-2xl shadow-md p-6 border-t-4 border-purple-600">
                    <div class="flex items-center mb-4">
                        <i class="fa-solid fa-graduation-cap text-3xl text-purple-600 mr-3"></i>
                        <h2 class="text-2xl font-bold text-gray-800 font-head">‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÇ‡∏•‡∏Å‡∏¢‡∏∏‡∏Ñ‡πÉ‡∏´‡∏°‡πà</h2>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-6">
                        <div class="p-4 bg-purple-50 rounded-xl text-center border border-purple-100">
                            <i class="fa-brands fa-bitcoin text-2xl text-purple-600 mb-2"></i>
                            <div class="font-bold text-sm text-purple-900">Crypto & Finance</div>
                            <div class="text-xs text-gray-500">‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡πÇ‡∏•‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</div>
                        </div>
                        <div class="p-4 bg-purple-50 rounded-xl text-center border border-purple-100">
                            <i class="fa-solid fa-campground text-2xl text-purple-600 mb-2"></i>
                            <div class="font-bold text-sm text-purple-900">Survival Skills</div>
                            <div class="text-xs text-gray-500">‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏≠‡∏≤‡∏ï‡∏±‡∏ß‡∏£‡∏≠‡∏î</div>
                        </div>
                        <div class="p-4 bg-purple-50 rounded-xl text-center border border-purple-100">
                            <i class="fa-solid fa-spa text-2xl text-purple-600 mb-2"></i>
                            <div class="font-bold text-sm text-purple-900">‡∏™‡∏°‡∏≤‡∏ò‡∏¥‡∏†‡∏≤‡∏ß‡∏ô‡∏≤</div>
                            <div class="text-xs text-gray-500">‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</div>
                        </div>
                    </div>
                </div>

                <!-- Structure Column -->
                <div class="md:col-span-1 bg-white rounded-2xl shadow-md p-6 border-t-4 border-gray-600">
                    <div class="flex items-center mb-4">
                        <i class="fa-solid fa-handshake text-3xl text-gray-600 mr-3"></i>
                        <h2 class="text-2xl font-bold text-gray-800 font-head">‡∏Ñ‡πà‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
                    </div>
                    <div class="chart-container" style="height: 200px;">
                        <canvas id="membershipChart"></canvas>
                    </div>
                    <div class="text-center mt-2">
                        <p class="text-xs text-gray-500">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ñ‡πà‡∏≤‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏û‡∏£‡∏£‡∏Ñ (‡∏ö‡∏≤‡∏ó)</p>
                    </div>
                </div>
            </section>
        </div>

        <div class="container mx-auto px-4 py-12 max-w-6xl">
            <!-- Application Section -->
            <section class="py-16 bg-white relative overflow-hidden border-t border-gray-100">
                <div class="container mx-auto px-4 relative z-10">
                    <div class="text-center mb-16">
                        <span class="text-orange-600 font-bold tracking-wider text-sm uppercase">JOIN OUR MISSION</span>
                        <h2 class="text-3xl md:text-5xl font-bold font-head text-gray-800 mt-2 mb-4">‡∏ó‡∏≥‡πÑ‡∏°‡∏ó‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á
                            "‡∏Å‡πâ‡∏≤‡∏ß‡∏≠‡∏≠‡∏Å‡∏°‡∏≤" ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤?</h2>
                        <p class="text-xl text-gray-600 max-w-3xl mx-auto">‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡∏£‡∏±‡∏ê
                            ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏£‡∏≤‡∏∞‡∏Ñ‡∏∏‡πâ‡∏°‡∏Å‡∏±‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢</p>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-5xl mx-auto">
                        <!-- Member Card -->
                        <div
                            class="bg-gradient-to-br from-orange-50 to-white border border-orange-100 rounded-3xl p-8 shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 group">
                            <h3 class="text-2xl font-bold font-head text-gray-800 mb-4"><i
                                    class="fa-solid fa-users mr-2"></i> ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏õ‡πá‡∏ô "‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏û‡∏£‡∏£‡∏Ñ"</h3>
                            <ul class="space-y-3 text-gray-700 mb-8 text-sm">
                                <li><i class="fa-solid fa-check-circle text-green-500 mt-1"></i>
                                    <span><strong>‡∏ö‡∏±‡∏ç‡∏ç‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ô‡∏≤‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏≤‡∏ï‡∏¥:</strong> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á‡∏ó‡∏≤‡∏á‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ç‡∏ç‡∏≤‡∏ì</span>
                                </li>
                                <li><i class="fa-solid fa-check-circle text-green-500 mt-1"></i>
                                    <span><strong>‡∏ï‡∏±‡πâ‡∏á‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏û‡∏∏‡∏ó‡∏ò:</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ò‡∏£‡∏£‡∏°</span>
                                </li>
                            </ul>
                            <button onclick="handlePublicAction('member')"
                                class="w-full py-3 bg-white border-2 border-orange-600 text-orange-600 font-bold rounded-xl hover:bg-orange-600 hover:text-white transition shadow-sm action-btn">
                                ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏û‡∏£‡∏£‡∏Ñ
                            </button>
                        </div>
                        <!-- Candidate Card -->
                        <div
                            class="bg-gradient-to-br from-blue-50 to-white border border-blue-100 rounded-3xl p-8 shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 group">
                            <h3 class="text-2xl font-bold font-head text-gray-800 mb-4"><i
                                    class="fa-solid fa-user-tie mr-2"></i> ‡∏≠‡∏≤‡∏™‡∏≤‡πÄ‡∏õ‡πá‡∏ô "‡∏ú‡∏π‡πâ‡πÅ‡∏ó‡∏ô‡∏£‡∏≤‡∏©‡∏é‡∏£ (‡∏™.‡∏™.)"</h3>
                            <ul class="space-y-3 text-gray-700 mb-8 text-sm">
                                <li><i class="fa-solid fa-gavel text-blue-500 mt-1"></i>
                                    <span><strong>‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏≤‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡πâ‡∏û‡∏£‡∏∞‡∏™‡∏á‡∏Ü‡πå:</strong> ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ó‡πà‡∏≤‡∏ô‡∏û‡∏π‡∏î‡πÄ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏™‡∏†‡∏≤</span>
                                </li>
                                <li><i class="fa-solid fa-hand-holding-heart text-blue-500 mt-1"></i>
                                    <span><strong>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß:</strong> ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏¢‡πå</span>
                                </li>
                            </ul>
                            <button onclick="handlePublicAction('candidate')"
                                class="w-full py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 shadow-lg transition action-btn">
                                ‡πÄ‡∏™‡∏ô‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‡∏™.‡∏™.
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <footer class="bg-gray-900 text-gray-400 py-8 mt-12 rounded-t-xl text-sm">
                <div class="container mx-auto px-4 text-center">
                    <img src="https://firebasestorage.googleapis.com/v0/b/susanonline-9ccbb.firebasestorage.app/o/pak%2Flogopak.png?alt=media&token=30557e25-5d5a-46f8-be24-babeaf095fad"
                        class="w-16 h-16 mx-auto mb-4 opacity-80">
                    <div class="border-t border-gray-700 my-4 pt-4 text-xs leading-relaxed">
                        <p class="font-bold text-gray-300 mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏∑‡πà‡∏≠‡∏´‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏≤‡∏á‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå</p>
                        <p><strong>‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï:</strong> ‡∏ô‡∏≤‡∏¢‡∏ß‡∏¥‡∏ô‡∏±‡∏¢ ‡∏ú‡∏±‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏® ( ‡∏ú‡∏•‡∏¥‡∏ï‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ) <strong>‡∏ú‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á:</strong>
                            ‡∏û‡∏£‡∏£‡∏Ñ‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô‡∏ò‡∏£‡∏£‡∏°</p>
                        <p><strong>‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï:</strong> 26 ‡∏û.‡∏¢. 2568 <strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï:</strong> 1 ‡∏ä‡∏∏‡∏î
                            (‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå)</p>
                    </div>
                    <p class="text-xs mt-2">&copy; 2025 ‡∏û‡∏£‡∏£‡∏Ñ‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô‡∏ò‡∏£‡∏£‡∏°. All rights reserved.</p>
                </div>
            </footer>
        </div>
    </div>

    <!-- AUTH PAGE -->
    <div id="view-auth" class="hidden flex-grow flex items-center justify-center p-4 bg-gray-100 fade-in">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden border-t-4 border-orange-600">
            <div class="p-8 text-center">
                <img src="https://firebasestorage.googleapis.com/v0/b/susanonline-9ccbb.firebasestorage.app/o/pak%2Flogopak.png?alt=media&token=30557e25-5d5a-46f8-be24-babeaf095fad"
                    class="w-20 h-20 mx-auto mb-4">
                <h2 class="text-2xl font-bold text-gray-800 font-head">‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
                <form onsubmit="handleAuth(event)" class="text-left mt-6">
                    <input type="email" id="email"
                        class="w-full p-3 mb-4 border rounded-lg focus:ring-2 focus:ring-orange-500 outline-none"
                        placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" required autocomplete="username">
                    <div class="password-container mb-6">
                        <input type="password" id="password"
                            class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-orange-500 outline-none pr-10"
                            placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required autocomplete="current-password">
                        <i class="fa-solid fa-eye password-toggle" onclick="togglePassword('password', this)"></i>
                    </div>
                    <button
                        class="w-full bg-orange-600 text-white font-bold py-3 rounded-lg hover:bg-orange-700 shadow-lg transition action-btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                </form>
                <div class="mt-4 flex justify-between text-xs text-gray-400">
                    <span class="cursor-pointer hover:text-orange-600"
                        onclick="handleForgotPassword()">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</span>
                    <span class="cursor-pointer hover:text-orange-600"
                        onclick="switchAuthMode('register')">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÅ‡∏≠‡∏û</span>
                </div>
            </div>
        </div>
    </div>

    <!-- RESET PASSWORD PAGE -->
    <div id="view-reset" class="hidden flex-grow flex items-center justify-center p-4 bg-gray-100 fade-in">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden border-t-4 border-red-500">
            <div class="p-8 text-center">
                <h2 class="text-2xl font-bold text-gray-800 font-head">‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
                <form onsubmit="handleUpdatePassword(event)" class="text-left mt-6">
                    <div class="password-container mb-6">
                        <input type="password" id="new-password"
                            class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-red-500 outline-none pr-10"
                            placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)" required minlength="6"
                            autocomplete="new-password">
                        <i class="fa-solid fa-eye password-toggle" onclick="togglePassword('new-password', this)"></i>
                    </div>
                    <button
                        class="w-full bg-red-600 text-white font-bold py-3 rounded-lg hover:bg-red-700 shadow-lg transition action-btn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</button>
                </form>
            </div>
        </div>
    </div>

    <!-- MEMBER CENTER PAGE -->
    <div id="view-member-center" class="hidden flex-grow bg-gray-50 fade-in">
        <div class="container mx-auto px-4 py-8 max-w-6xl">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-bold text-gray-800 font-head">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡∏û‡∏•‡∏±‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
                <div class="h-1 w-24 bg-blue-500 mx-auto rounded-full mt-2"></div>
            </div>

            <!-- NEWS & ACTIVITIES -->
            <div class="mb-12">
                <div class="flex justify-between items-end mb-6">
                    <h3 class="text-xl font-bold text-gray-800 font-head border-l-4 border-orange-500 pl-3">
                        ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>
                    <button id="btn-create-post" onclick="openPostModal('create')"
                        class="hidden bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-bold shadow hover:bg-orange-700 transition action-btn">
                        <i class="fa-solid fa-plus mr-1"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏°‡πà
                    </button>
                </div>
                <div id="news-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="col-span-full text-center py-12 text-gray-400 bg-white rounded-xl border border-dashed">
                        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£...</div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
                <!-- Support -->
                <div class="bg-white rounded-2xl shadow-md overflow-hidden border border-gray-100">
                    <div class="bg-orange-600 p-6 text-white text-center">
                        <i class="fa-solid fa-hand-holding-heart text-5xl mb-4"></i>
                        <h3 class="text-2xl font-bold font-head">‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏≠‡∏∏‡∏î‡∏°‡∏Å‡∏≤‡∏£‡∏ì‡πå</h3>
                        <p class="text-orange-100 text-sm">‡∏£‡πà‡∏ß‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏û‡∏•‡∏±‡∏á‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡∏û‡∏£‡∏∞‡∏û‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ô‡∏≤</p>
                    </div>
                    <div class="p-6">
                        <button onclick="alert('‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏≠‡∏∏‡∏î‡∏°‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏û‡∏£‡∏£‡∏Ñ! (‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö)')"
                            class="w-full py-3 bg-orange-50 text-orange-600 border border-orange-200 rounded-xl font-bold hover:bg-orange-600 hover:text-white transition action-btn">
                            <i class="fa-solid fa-pen-nib mr-2"></i> ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô
                        </button>
                    </div>
                </div>

                <!-- Knowledge Library (Updated) -->
                <div class="bg-white rounded-2xl shadow-md overflow-hidden border border-gray-100 relative group">
                    <div class="bg-blue-600 p-6 text-white text-center relative">
                        <i class="fa-solid fa-book-open text-5xl mb-4"></i>
                        <h3 class="text-2xl font-bold font-head">‡∏Ñ‡∏•‡∏±‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ</h3>
                        <p class="text-blue-100 text-sm">‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢ ‡∏Ç‡πâ‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏û‡∏£‡∏£‡∏Ñ ‡πÅ‡∏•‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà</p>
                        <button id="btn-add-knowledge"
                            onclick="document.getElementById('modal-knowledge').classList.remove('hidden'); document.getElementById('modal-knowledge').classList.add('flex');"
                            class="hidden absolute top-4 right-4 bg-white/20 hover:bg-white/40 text-white p-2 rounded-full transition backdrop-blur-sm border border-white/30">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        <ul id="knowledge-list" class="space-y-3">
                            <li class="text-center text-gray-400 text-sm py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Feedback Form -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden max-w-4xl mx-auto mb-12">
                <div class="bg-gray-800 p-4 px-6 text-white">
                    <h3 class="text-lg font-bold font-head"><i class="fa-regular fa-comments mr-2"></i> ‡πÄ‡∏™‡∏ô‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô
                        / ‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                </div>
                <div class="p-8">
                    <form onsubmit="handleFeedbackSubmit(event)">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label class="text-xs font-bold text-gray-500 mb-1 block">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</label>
                                <select id="fb-type" required
                                    class="w-full p-3 border rounded-lg bg-gray-50 outline-none">
                                    <option value="suggestion">üí° ‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞ / ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</option>
                                    <option value="complaint">‚ö†Ô∏è ‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤ / ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ö‡∏≤‡∏∞‡πÅ‡∏™</option>
                                    <option value="question">‚ùì ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-500 mb-1 block">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</label>
                                <input id="fb-topic" required
                                    class="w-full p-3 border rounded-lg bg-gray-50 outline-none"
                                    placeholder="‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏±‡πâ‡∏ô‡πÜ">
                            </div>
                        </div>
                        <div class="mb-6">
                            <label class="text-xs font-bold text-gray-500 mb-1 block">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                            <textarea id="fb-detail" required
                                class="w-full p-3 border rounded-lg bg-gray-50 outline-none h-32"
                                placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô..."></textarea>
                        </div>
                        <div class="flex justify-end">
                            <button type="submit" id="btn-feedback-submit"
                                class="bg-green-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-green-700 transition flex items-center gap-2 action-btn">
                                <i class="fa-solid fa-paper-plane"></i> ‡∏™‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Feedback Board -->
            <div class="mt-12">
                <h3 class="text-xl font-bold text-gray-800 font-head mb-6 text-center">üìã
                    ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏ô‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-600">
                            <thead class="bg-gray-100 text-gray-700 uppercase text-xs font-bold">
                                <tr>
                                    <th class="px-6 py-3 w-24">Ticket ID</th>
                                    <th class="px-6 py-3 w-32">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th class="px-6 py-3 w-32">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                    <th class="px-6 py-3">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡πà‡∏≤‡∏ô)</th>
                                    <th class="px-6 py-3 text-right">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                </tr>
                            </thead>
                            <tbody id="feedback-table-body" class="divide-y divide-gray-100"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- POST MODAL -->
    <div id="modal-post"
        class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50 backdrop-blur-sm flex overflow-y-auto py-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl mx-4 my-auto relative">
            <div class="px-6 py-4 border-b flex justify-between items-center rounded-t-xl bg-orange-600 text-white">
                <h3 class="text-lg font-bold font-head" id="modal-post-title">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏°‡πà</h3>
                <button onclick="closePostModal()" class="hover:text-gray-300"><i
                        class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="p-6">
                <form id="postForm" onsubmit="savePost(event)">
                    <input type="hidden" id="post-id">
                    <div class="mb-4">
                        <label class="text-xs font-bold text-gray-500 mb-1 block">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß</label>
                        <input id="inp-post-title" required class="w-full p-2 border rounded"
                            placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà...">
                    </div>
                    <div id="post-target-wrapper" class="mb-4 hidden">
                        <label class="text-xs font-bold text-gray-500 mb-1 block">‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡πÉ‡∏ô‡∏ô‡∏≤‡∏°</label>
                        <select id="inp-post-target" class="w-full p-2 border rounded bg-white">
                            <option value="ALL">‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á (‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏∏‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î)</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="text-xs font-bold text-gray-500 mb-1 block">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                        <input type="file" id="inp-post-img" accept="image/*"
                            class="w-full p-2 border rounded bg-gray-50 text-sm">
                        <div id="post-img-preview" class="mt-2 hidden"><img src=""
                                class="h-32 rounded border object-cover"></div>
                    </div>
                    <div class="mb-6">
                        <label class="text-xs font-bold text-gray-500 mb-1 block">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πà‡∏≤‡∏ß</label>
                        <textarea id="inp-post-content" required class="w-full p-2 border rounded h-32"
                            placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..."></textarea>
                    </div>
                    <div class="flex justify-end gap-2 pt-4 border-t">
                        <button type="button" onclick="closePostModal()"
                            class="px-4 py-2 bg-gray-100 rounded hover:bg-gray-200 action-btn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit" id="btn-post-save"
                            class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 shadow font-bold action-btn">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡πà‡∏≤‡∏ß</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- DASHBOARD PAGE -->
    <div id="view-dashboard" class="hidden flex-grow bg-gray-50 fade-in">
        <div class="container mx-auto px-4 py-8 max-w-6xl">
            <!-- NEW SECTION: EXECUTIVE COMMITTEE -->
            <div class="mb-10">
                <div class="flex items-center gap-3 mb-6">
                    <div class="bg-orange-600 text-white w-10 h-10 rounded-lg flex items-center justify-center shadow">
                        <i class="fa-solid fa-users-gear text-lg"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 font-head">‡∏Ñ‡∏ì‡∏∞‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏û‡∏£‡∏£‡∏Ñ</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="executive-container">
                    <!-- Executives will be rendered here via JS -->
                </div>
            </div>

            <hr class="border-gray-200 mb-8">

            <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-8">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 font-head">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
                    <p class="text-sm text-gray-500" id="user-display">User</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="handlePublicAction('member')"
                        class="bg-blue-600 text-white hover:bg-blue-700 px-4 py-2 rounded-lg font-bold text-sm shadow flex items-center gap-2 action-btn">
                        <i class="fa-solid fa-user-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
                    </button>
                    <button onclick="handlePublicAction('candidate')"
                        class="bg-orange-600 text-white hover:bg-orange-700 px-4 py-2 rounded-lg font-bold text-sm shadow flex items-center gap-2 action-btn">
                        <i class="fa-solid fa-user-tie"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‡∏™.‡∏™.
                    </button>
                </div>
            </div>

            <!-- Filters -->
            <div class="flex gap-2 mb-6 overflow-x-auto pb-2">
                <button onclick="filterDashboard('all')"
                    class="filter-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm font-bold whitespace-nowrap active-filter action-btn"
                    data-filter="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button onclick="filterDashboard('member')"
                    class="filter-btn px-4 py-2 rounded-lg bg-white border text-gray-600 text-sm font-bold whitespace-nowrap action-btn"
                    data-filter="member">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏û‡∏£‡∏£‡∏Ñ</button>
                <button onclick="filterDashboard('candidate')"
                    class="filter-btn px-4 py-2 rounded-lg bg-white border text-gray-600 text-sm font-bold whitespace-nowrap action-btn"
                    data-filter="candidate">‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‡∏™.‡∏™.</button>
                <button onclick="filterDashboard('feedback')"
                    class="filter-btn px-4 py-2 rounded-lg bg-white border text-gray-600 text-sm font-bold whitespace-nowrap action-btn"
                    data-filter="feedback">‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞/‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                <button onclick="filterDashboard('post')"
                    class="filter-btn px-4 py-2 rounded-lg bg-white border text-gray-600 text-sm font-bold whitespace-nowrap action-btn"
                    data-filter="post">‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</button>
                <button onclick="filterDashboard('knowledge')"
                    class="filter-btn px-4 py-2 rounded-lg bg-white border text-gray-600 text-sm font-bold whitespace-nowrap action-btn"
                    data-filter="knowledge">‡∏Ñ‡∏•‡∏±‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ</button>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-gray-500">
                    <p class="text-xs text-gray-500 font-bold">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏≠‡∏û (‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå)</p>
                    <h3 class="text-2xl font-bold text-gray-700" id="stat-users">-</h3>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-blue-500">
                    <p class="text-xs text-gray-500 font-bold">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏û‡∏£‡∏£‡∏Ñ (‡∏£‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏°+‡πÉ‡∏´‡∏°‡πà)</p>
                    <h3 class="text-2xl font-bold text-blue-600" id="stat-total">-</h3>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-orange-500">
                    <p class="text-xs text-gray-500 font-bold">‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‡∏™.‡∏™. (‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö)</p>
                    <h3 class="text-2xl font-bold text-orange-600" id="stat-candidate">-</h3>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border p-6 mb-6">
                <h3 class="text-lg font-bold text-gray-800 font-head mb-4"><i
                        class="fa-solid fa-map-location-dot text-orange-600 mr-2"></i> ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏£‡∏≤‡∏¢‡∏†‡∏≤‡∏Ñ</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4" id="region-stats-container"></div>
            </div>

            <!-- Search & Table -->
            <div class="mb-4 relative">
                <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"><i
                        class="fa-solid fa-search text-gray-400"></i></div>
                <input type="text" id="inp-search" onkeyup="handleSearch()"
                    class="block w-full p-4 pl-10 text-sm border rounded-lg bg-white shadow-sm"
                    placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤... (‡∏ä‡∏∑‡πà‡∏≠, ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å, ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£)">
            </div>

            <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-600">
                        <thead class="bg-gray-100 text-gray-600 uppercase text-xs font-bold">
                            <tr>
                                <th class="px-6 py-4 sortable" onclick="sortTable('member_id')">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å <i
                                        class="fa-solid fa-sort ml-1"></i></th>
                                <th class="px-6 py-4 sortable" onclick="sortTable('start_date')">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£ <i
                                        class="fa-solid fa-sort ml-1"></i></th>
                                <th class="px-6 py-4 sortable" onclick="sortTable('name')">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• / ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ <i
                                        class="fa-solid fa-sort ml-1"></i></th>
                                <th class="px-6 py-4 sortable" onclick="sortTable('type')">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ <i
                                        class="fa-solid fa-sort ml-1"></i></th>
                                <th class="px-6 py-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</th>
                                <th class="px-6 py-4">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà / ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                                <th class="px-6 py-4 sortable" onclick="sortTable('province')">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î <i
                                        class="fa-solid fa-sort ml-1"></i></th>
                                <th class="px-6 py-4 text-right">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="table-body" class="divide-y divide-gray-100"></tbody>
                    </table>
                </div>
                <div id="loading" class="hidden py-12 text-center text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                <div id="empty-state" class="hidden py-12 text-center text-gray-400">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
            </div>
        </div>
    </div>

    <!-- NEW MODAL: FEEDBACK MANAGER (SEPARATED) -->
    <div id="modal-feedback-manage"
        class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50 backdrop-blur-sm flex overflow-y-auto py-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg mx-4 my-auto relative">
            <div class="px-6 py-4 border-b flex justify-between items-center rounded-t-xl bg-purple-600 text-white">
                <h3 class="text-lg font-bold font-head"><i class="fa-solid fa-list-check mr-2"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞
                </h3>
                <button onclick="document.getElementById('modal-feedback-manage').classList.add('hidden')"
                    class="hover:text-gray-300"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="p-6">
                <input type="hidden" id="fb-manage-id">

                <div class="mb-4 bg-gray-50 p-3 rounded-lg border border-gray-100">
                    <div class="flex justify-between items-start mb-2">
                        <span id="fb-manage-type"
                            class="text-xs font-bold px-2 py-1 rounded bg-gray-200 text-gray-600">Type</span>
                        <span id="fb-manage-date" class="text-xs text-gray-400">Date</span>
                    </div>
                    <h4 id="fb-manage-topic" class="font-bold text-gray-800 text-lg mb-2">Topic</h4>
                    <p id="fb-manage-detail" class="text-sm text-gray-600 whitespace-pre-line">Detail...</p>
                    <p class="text-xs text-gray-400 mt-2">‡πÇ‡∏î‡∏¢: <span id="fb-manage-by">User</span></p>
                </div>

                <div class="mb-6">
                    <label class="text-xs font-bold text-gray-500 mb-1 block">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ (‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞)</label>
                    <select id="fb-manage-status" class="w-full p-2 border rounded bg-white mb-2">
                        <option value="PENDING">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö (Pending)</option>
                        <option value="RESOLVED">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô (Resolved)</option>
                    </select>
                </div>

                <div class="flex justify-end gap-2 pt-4 border-t">
                    <button type="button"
                        onclick="document.getElementById('modal-feedback-manage').classList.add('hidden')"
                        class="px-4 py-2 bg-gray-100 rounded hover:bg-gray-200 action-btn">‡∏õ‡∏¥‡∏î</button>
                    <button type="button" onclick="saveFeedbackStatus(event)"
                        class="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 shadow font-bold action-btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL FORM (MEMBER - EMAIL INSTRUCTION) -->
    <div id="modal-form"
        class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50 backdrop-blur-sm flex overflow-y-auto py-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl mx-4 my-auto relative">
            <div id="modal-header"
                class="px-6 py-4 border-b flex justify-between items-center rounded-t-xl bg-gray-800 text-white">
                <h3 class="text-lg font-bold font-head" id="modal-title">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</h3>
                <button onclick="closeModal()" class="hover:text-gray-300"><i
                        class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="p-6">
                <!-- Admin Tools -->
                <div id="admin-tools" class="hidden mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <h4 class="text-sm font-bold text-yellow-800 mb-2 border-b border-yellow-200 pb-1">
                        ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <label class="flex items-center gap-2 cursor-pointer font-bold text-yellow-800">
                            <input type="checkbox" id="inp-is-old" class="w-5 h-5 text-yellow-600 rounded">
                            <span>‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏¥‡∏° (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏±‡∏ö‡∏¢‡∏≠‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°)</span>
                        </label>
                        <div id="admin-role-setting" class="hidden">
                            <label class="text-xs font-bold text-yellow-800 block mb-1">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label>
                            <select id="inp-admin-role"
                                class="w-full p-2 border border-yellow-300 rounded bg-white text-sm">
                                <option value="">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (User)</option>
                                <option value="ALL">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (Super Admin)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <form id="memberForm" onsubmit="saveData(event)">
                    <input type="hidden" id="record-id">
                    <input type="hidden" id="inp-type">

                    <h4 class="text-sm font-bold text-gray-800 border-b pb-2 mb-4"><i class="fa-regular fa-id-card"></i>
                        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="md:col-span-1">
                            <label class="text-xs font-bold text-gray-500">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</label>
                            <input id="inp-member-id" class="w-full p-2 border rounded font-mono"
                                placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ">
                        </div>
                        <div class="md:col-span-2">
                            <label class="text-xs font-bold text-gray-500">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span
                                    class="text-red-500">*</span></label>
                            <input id="inp-name" required class="w-full p-2 border rounded" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500">‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î</label>
                            <input type="date" id="inp-dob" class="w-full p-2 border rounded text-gray-500">
                        </div>
                        <div class="col-span-3 md:col-span-1">
                            <label class="text-xs font-bold text-gray-500">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</label>
                            <input type="date" id="inp-start-date" class="w-full p-2 border rounded text-gray-500">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500 flex justify-between">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô <span
                                    class="text-xs text-orange-500 font-normal">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</span></label>
                            <input id="inp-id" maxlength="13" class="w-full p-2 border rounded" placeholder="13 ‡∏´‡∏•‡∏±‡∏Å">
                            <p id="id-error" class="text-xs text-red-500 mt-1 hidden">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
                        </div>
                        <div class="md:col-span-1">
                            <label class="text-xs font-bold text-gray-500">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</label>
                            <input id="inp-recommender" class="w-full p-2 border rounded" placeholder="(‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)">
                        </div>
                    </div>

                    <h4 class="text-sm font-bold text-gray-800 border-b pb-2 mb-4"><i class="fa-solid fa-house"></i>
                        ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="md:col-span-2">
                            <label class="text-xs font-bold text-gray-500">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà/‡∏´‡∏°‡∏π‡πà)</label>
                            <input id="inp-addr" class="w-full p-2 border rounded" placeholder="‡πÄ‡∏ä‡πà‡∏ô 99/1 ‡∏´‡∏°‡∏π‡πà 5">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î <span
                                    class="text-red-500">*</span></label>
                            <select id="inp-prov" required class="w-full p-2 border rounded bg-white">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option>
                            </select>
                        </div>
                        <div><input id="inp-district" class="w-full p-2 border rounded" placeholder="‡∏≠‡∏≥‡πÄ‡∏†‡∏≠"></div>
                        <div><input id="inp-tambon" class="w-full p-2 border rounded" placeholder="‡∏ï‡∏≥‡∏ö‡∏•"></div>
                        <div><input id="inp-zip" class="w-full p-2 border rounded" placeholder="‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå"></div>
                    </div>

                    <h4 class="text-sm font-bold text-gray-800 border-b pb-2 mb-4"><i class="fa-solid fa-phone"></i>
                        ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h4>
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="col-span-3 md:col-span-1">
                            <label class="text-xs font-bold text-gray-500">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (10 ‡∏´‡∏•‡∏±‡∏Å)</label>
                            <input id="inp-phone" maxlength="10" class="w-full p-2 border rounded"
                                placeholder="0xxxxxxxxx">
                            <p id="phone-error" class="text-xs text-red-500 mt-1 hidden">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
                        </div>
                        <div class="col-span-3 md:col-span-1">
                            <label class="text-xs font-bold text-gray-500">Line ID</label>
                            <input id="inp-line" class="w-full p-2 border rounded" placeholder="Line ID">
                        </div>
                        <div class="col-span-3 md:col-span-1">
                            <label class="text-xs font-bold text-gray-500">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                            <input id="inp-email" type="email" class="w-full p-2 border rounded"
                                placeholder="email@example.com">
                        </div>
                    </div>

                    <h4 class="text-sm font-bold text-gray-800 border-b pb-2 mb-4"><i
                            class="fa-regular fa-comment-dots"></i> ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</h4>

                    <div class="mb-6">
                        <label class="text-xs font-bold text-gray-500">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                        <textarea id="inp-remarks" class="w-full p-2 border rounded h-20"
                            placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..."></textarea>
                    </div>

                    <!-- PDPA Consent Checkbox -->
                    <div class="mb-6 bg-gray-50 p-4 rounded-lg border border-gray-100">
                        <label class="flex items-start gap-3 cursor-pointer group">
                            <div class="relative flex items-center pt-1">
                                <input type="checkbox" required id="inp-pdpa"
                                    class="peer h-5 w-5 cursor-pointer appearance-none rounded border border-gray-300 bg-white shadow-sm checked:bg-orange-600 checked:border-orange-600 focus:ring-2 focus:ring-orange-500 transition-all">
                                <i
                                    class="fa-solid fa-check text-white absolute left-1/2 top-1/2 pt-1 -translate-x-1/2 -translate-y-1/2 text-xs opacity-0 peer-checked:opacity-100 transition-opacity pointer-events-none"></i>
                            </div>
                            <span class="text-sm text-gray-600 leading-tight group-hover:text-gray-800 transition">
                                ‡∏Ç‡πâ‡∏≤‡∏û‡πÄ‡∏à‡πâ‡∏≤‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏û‡∏£‡∏£‡∏Ñ‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° ‡πÉ‡∏ä‡πâ ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ô‡∏µ‡πâ
                                ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏û‡∏£‡∏£‡∏Ñ
                                <span class="text-red-500">*</span>
                            </span>
                        </label>
                    </div>

                    <div class="flex justify-end gap-2 pt-4 border-t">
                        <button type="button" onclick="closeModal()"
                            class="px-4 py-2 bg-gray-100 rounded hover:bg-gray-200 action-btn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit" id="btn-save"
                            class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 shadow font-bold action-btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- KNOWLEDGE MODAL -->
    <div id="modal-knowledge"
        class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50 backdrop-blur-sm flex overflow-y-auto py-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 my-auto relative">
            <div class="px-6 py-4 border-b flex justify-between items-center rounded-t-xl bg-blue-600 text-white">
                <h3 class="text-lg font-bold font-head"><i class="fa-solid fa-file-arrow-up mr-2"></i> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
                </h3>
                <button onclick="document.getElementById('modal-knowledge').classList.add('hidden')"
                    class="hover:text-gray-300"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="p-6">
                <form onsubmit="saveKnowledge(event)">
                    <div class="mb-4">
                        <label class="text-xs font-bold text-gray-500 mb-1 block">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ / ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</label>
                        <input id="inp-know-title" required class="w-full p-2 border rounded"
                            placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏û‡∏£‡∏£‡∏Ñ 2568">
                    </div>
                    <div class="mb-4">
                        <label class="text-xs font-bold text-gray-500 mb-1 block">‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 1 (PDF)</label>
                        <input type="file" id="inp-know-file-1" accept="application/pdf"
                            class="w-full p-2 border rounded bg-gray-50 text-sm">
                    </div>
                    <div class="mb-6">
                        <label class="text-xs font-bold text-gray-500 mb-1 block">‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 2 (PDF) (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                        <input type="file" id="inp-know-file-2" accept="application/pdf"
                            class="w-full p-2 border rounded bg-gray-50 text-sm">
                    </div>
                    <div class="flex justify-end gap-2 pt-4 border-t">
                        <button type="button"
                            onclick="document.getElementById('modal-knowledge').classList.add('hidden')"
                            class="px-4 py-2 bg-gray-100 rounded hover:bg-gray-200 action-btn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit" id="btn-know-save"
                            class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 shadow font-bold action-btn">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- KNOWLEDGE READER MODAL -->
    <div id="modal-knowledge-read"
        class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50 backdrop-blur-sm p-4">
        <div
            class="bg-white rounded-xl shadow-2xl w-full max-w-2xl relative overflow-hidden flex flex-col max-h-[90vh]">
            <div class="bg-blue-600 p-6 text-white flex justify-between items-start">
                <div>
                    <h3 id="kn-read-title" class="text-xl font-bold font-head leading-snug"></h3>
                    <div id="kn-read-files" class="mt-3 flex flex-wrap gap-2"></div>
                </div>
                <button onclick="document.getElementById('modal-knowledge-read').classList.add('hidden')"
                    class="text-blue-200 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="p-0 flex-grow overflow-hidden flex flex-col">
                <div id="kn-interaction-area" class="flex-grow overflow-y-auto bg-gray-50 p-6 reader-scroll">
                </div>
            </div>
        </div>
    </div>

    <!-- NEWS READER MODAL -->
    <div id="modal-news-reader"
        class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50 backdrop-blur-md p-4 fade-in">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl h-[90vh] flex flex-col relative overflow-hidden">
            <button onclick="document.getElementById('modal-news-reader').classList.add('hidden')"
                class="absolute top-4 right-4 bg-black/50 text-white w-10 h-10 rounded-full hover:bg-black/70 flex items-center justify-center z-10 transition">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
            <div id="news-reader-img-container" class="w-full h-64 bg-gray-200 shrink-0 hidden">
                <img id="news-reader-img" src="" class="w-full h-full object-cover">
            </div>
            <div class="p-8 overflow-y-auto flex-grow reader-scroll">
                <span id="news-reader-date"
                    class="text-orange-600 font-bold text-sm tracking-wider uppercase mb-2 block"></span>
                <h2 id="news-reader-title" class="text-3xl font-bold font-head text-gray-900 mb-6 leading-tight"></h2>
                <div id="news-reader-content"
                    class="prose prose-lg text-gray-700 leading-relaxed whitespace-pre-line mb-8"></div>

                <hr class="border-gray-200 mb-6">
                <!-- Interaction Area -->
                <div id="news-interaction-area"></div>
            </div>
        </div>
    </div>

    <!-- FEEDBACK READER MODAL -->
    <div id="modal-feedback-read"
        class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50 backdrop-blur-sm p-4">
        <div
            class="bg-white rounded-xl shadow-2xl w-full max-w-2xl relative overflow-hidden flex flex-col max-h-[90vh]">
            <div class="bg-gray-800 p-6 text-white flex justify-between items-start shrink-0">
                <div>
                    <span id="fb-read-type"
                        class="bg-gray-700 text-xs px-2 py-1 rounded text-gray-300 border border-gray-600 mb-2 inline-block"></span>
                    <h3 id="fb-read-topic" class="text-xl font-bold font-head leading-snug"></h3>
                    <p id="fb-read-date" class="text-gray-400 text-xs mt-1"></p>
                </div>
                <button onclick="document.getElementById('modal-feedback-read').classList.add('hidden')"
                    class="text-gray-400 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="p-6 overflow-y-auto flex-grow reader-scroll">
                <h4 class="text-sm font-bold text-gray-500 mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h4>
                <p id="fb-read-detail"
                    class="text-gray-800 text-lg leading-relaxed bg-gray-50 p-4 rounded-lg border border-gray-100 whitespace-pre-line mb-6">
                </p>
                <div id="fb-read-status" class="mb-6"></div>

                <hr class="border-gray-200 mb-6">
                <!-- Interaction Area -->
                <div id="fb-interaction-area"></div>
            </div>
        </div>
    </div>

    <script>
        // üî¥üî¥üî¥ CONFIGURATION üî¥üî¥üî¥
        const SUPABASE_URL = 'https://bhfytplqshiviuqwkvbm.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_vaRwFf5F6iAc7T_iFjlhAQ_xGk_dxRR';

        const { createClient } = supabase;
        const sb = createClient(SUPABASE_URL, SUPABASE_KEY);
        let isRegisterMode = false;
        let currentSession = null;
        let isEditMode = false;
        let cachedData = [];
        let filteredData = [];
        let sortConfig = { key: 'created_at', direction: -1 };
        const OLD_DATA_TAG = '(‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏¥‡∏°)';
        const STATUS_APPROVED_TAG = '{{STATUS:APPROVED}}';
        let isRecoveryMode = false;
        let activeFilter = 'all';

        // üü¢ EXECUTIVE DATA STRUCTURE (HARDCODED AS REQUESTED)
        const executiveData = [
            { id: 1, name: "‡∏ô‡∏≤‡∏¢ ‡∏ö‡∏∏‡∏ì‡∏¢‡∏ï‡∏¥‡πÄ‡∏•‡∏¥‡∏® ‡∏™‡∏≤‡∏£‡∏∞", pos: "‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏û‡∏£‡∏£‡∏Ñ", date: "6 ‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô 2568" },
            { id: 2, name: "‡∏ô‡∏≤‡∏¢ ‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏≤ ‡πÇ‡∏Ñ‡∏ï‡∏£‡∏†‡∏π‡∏ò‡∏£", pos: "‡πÄ‡∏•‡∏Ç‡∏≤‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡∏£‡∏£‡∏Ñ", date: "6 ‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô 2568" },
            { id: 3, name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß ‡∏£‡∏¢‡∏≤‡∏û‡∏≤ ‡πÄ‡∏ô‡∏Ç‡∏Ç‡∏±‡∏°‡∏°‡πå", pos: "‡πÄ‡∏´‡∏£‡∏±‡∏ç‡∏ç‡∏¥‡∏Å‡∏û‡∏£‡∏£‡∏Ñ", date: "6 ‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô 2568" },
            { id: 4, name: "‡∏ô‡∏≤‡∏á ‡∏à‡∏¥‡∏£‡∏≤‡∏†‡∏£‡∏ì‡πå ‡∏™‡∏≤‡∏£‡∏ï‡∏±‡∏ô‡∏ï‡∏¥‡∏û‡∏á‡∏®‡πå", pos: "‡∏ô‡∏≤‡∏¢‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏û‡∏£‡∏£‡∏Ñ", date: "6 ‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô 2568" },
            { id: 5, name: "‡∏ô‡∏≤‡∏¢ ‡∏ê‡∏¥‡∏ï‡∏¥‡πÄ‡∏°‡∏ò‡∏¥‡∏ô‡∏ó‡∏£‡πå ‡∏´‡∏•‡∏∏‡πà‡∏ô‡∏õ‡∏£‡∏∞‡∏û‡∏±‡∏ô‡∏ò‡πå", pos: "‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏û‡∏£‡∏£‡∏Ñ", date: "6 ‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô 2568" },
            { id: 6, name: "‡∏ô‡∏≤‡∏¢ ‡∏≠‡∏†‡∏¥‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥ ‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå", pos: "‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏û‡∏£‡∏£‡∏Ñ", date: "6 ‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô 2568" }
        ];

        // üî¥üî¥üî¥ ADMIN ROLES üî¥üî¥üî¥
        const ADMIN_ROLES = {
            'winayo@gmail.com': 'ALL',
            'pramahaweera@gmail.com': 'ALL',
            'admin_central@test.com': 'ALL',
            'admin_korat@test.com': '‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤',
            'winai0615322117@gmail.com': '‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î'
        };

        const PROVINCES = ["‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£", "‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà", "‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ", "‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå", "‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£", "‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô", "‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", "‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤", "‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", "‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó", "‡∏ä‡∏±‡∏¢‡∏†‡∏π‡∏°‡∏¥", "‡∏ä‡∏∏‡∏°‡∏û‡∏£", "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢", "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡∏ï‡∏£‡∏±‡∏á", "‡∏ï‡∏£‡∏≤‡∏î", "‡∏ï‡∏≤‡∏Å", "‡∏ô‡∏Ñ‡∏£‡∏ô‡∏≤‡∏¢‡∏Å", "‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°", "‡∏ô‡∏Ñ‡∏£‡∏û‡∏ô‡∏°", "‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤", "‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä", "‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå", "‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", "‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™", "‡∏ô‡πà‡∏≤‡∏ô", "‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨", "‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå", "‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå", "‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ", "‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ", "‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤", "‡∏û‡∏∞‡πÄ‡∏¢‡∏≤", "‡∏û‡∏±‡∏á‡∏á‡∏≤", "‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á", "‡∏û‡∏¥‡∏à‡∏¥‡∏ï‡∏£", "‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å", "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ", "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå", "‡πÅ‡∏û‡∏£‡πà", "‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï", "‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°", "‡∏°‡∏∏‡∏Å‡∏î‡∏≤‡∏´‡∏≤‡∏£", "‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô", "‡∏¢‡πÇ‡∏™‡∏ò‡∏£", "‡∏¢‡∏∞‡∏•‡∏≤", "‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î", "‡∏£‡∏∞‡∏ô‡∏≠‡∏á", "‡∏£‡∏∞‡∏¢‡∏≠‡∏á", "‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ", "‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ", "‡∏•‡∏≥‡∏õ‡∏≤‡∏á", "‡∏•‡∏≥‡∏û‡∏π‡∏ô", "‡πÄ‡∏•‡∏¢", "‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©", "‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£", "‡∏™‡∏á‡∏Ç‡∏•‡∏≤", "‡∏™‡∏ï‡∏π‡∏•", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£", "‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß", "‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢", "‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå", "‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢", "‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π", "‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á", "‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡πÄ‡∏à‡∏£‡∏¥‡∏ç", "‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏≠‡∏∏‡∏ï‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡πå", "‡∏≠‡∏∏‡∏ó‡∏±‡∏¢‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ"];

        function togglePassword(inputId, icon) {
            const input = document.getElementById(inputId);
            if (input.type === "password") {
                input.type = "text"; icon.classList.remove("fa-eye"); icon.classList.add("fa-eye-slash");
            } else {
                input.type = "password"; icon.classList.remove("fa-eye-slash"); icon.classList.add("fa-eye");
            }
        }

        function getRegion(province) {
            const regions = {
                "‡∏†‡∏≤‡∏Ñ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠": ["‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢", "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡∏ô‡πà‡∏≤‡∏ô", "‡∏û‡∏∞‡πÄ‡∏¢‡∏≤", "‡πÅ‡∏û‡∏£‡πà", "‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô", "‡∏•‡∏≥‡∏õ‡∏≤‡∏á", "‡∏•‡∏≥‡∏û‡∏π‡∏ô", "‡∏≠‡∏∏‡∏ï‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡πå"],
                "‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠": ["‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå", "‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô", "‡∏ä‡∏±‡∏¢‡∏†‡∏π‡∏°‡∏¥", "‡∏ô‡∏Ñ‡∏£‡∏û‡∏ô‡∏°", "‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤", "‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨", "‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå", "‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°", "‡∏°‡∏∏‡∏Å‡∏î‡∏≤‡∏´‡∏≤‡∏£", "‡∏¢‡πÇ‡∏™‡∏ò‡∏£", "‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î", "‡πÄ‡∏•‡∏¢", "‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£", "‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå", "‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©", "‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢", "‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π", "‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡πÄ‡∏à‡∏£‡∏¥‡∏ç"],
                "‡∏†‡∏≤‡∏Ñ‡∏Å‡∏•‡∏≤‡∏á": ["‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£", "‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£", "‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó", "‡∏ô‡∏Ñ‡∏£‡∏ô‡∏≤‡∏¢‡∏Å", "‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°", "‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå", "‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", "‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤", "‡∏û‡∏¥‡∏à‡∏¥‡∏ï‡∏£", "‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å", "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå", "‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£", "‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢", "‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏ö‡∏∏‡∏£‡∏µ", "‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á", "‡∏≠‡∏∏‡∏ó‡∏±‡∏¢‡∏ò‡∏≤‡∏ô‡∏µ"],
                "‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å": ["‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", "‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤", "‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", "‡∏ï‡∏£‡∏≤‡∏î", "‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ", "‡∏£‡∏∞‡∏¢‡∏≠‡∏á", "‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß"],
                "‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å": ["‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ", "‡∏ï‡∏≤‡∏Å", "‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå", "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ", "‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ"],
                "‡∏†‡∏≤‡∏Ñ‡πÉ‡∏ï‡πâ": ["‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà", "‡∏ä‡∏∏‡∏°‡∏û‡∏£", "‡∏ï‡∏£‡∏±‡∏á", "‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä", "‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™", "‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ", "‡∏û‡∏±‡∏á‡∏á‡∏≤", "‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á", "‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï", "‡∏£‡∏∞‡∏ô‡∏≠‡∏á", "‡∏™‡∏ï‡∏π‡∏•", "‡∏™‡∏á‡∏Ç‡∏•‡∏≤", "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏¢‡∏∞‡∏•‡∏≤"]
            };
            for (let r in regions) { if (regions[r].includes(province)) return r; }
            return "-";
        }

        function mapToMainRegion(region) {
            if (region === "‡∏†‡∏≤‡∏Ñ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠") return "‡∏†‡∏≤‡∏Ñ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠";
            if (region === "‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠") return "‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠";
            if (region === "‡∏†‡∏≤‡∏Ñ‡πÉ‡∏ï‡πâ") return "‡∏†‡∏≤‡∏Ñ‡πÉ‡∏ï‡πâ";
            if (["‡∏†‡∏≤‡∏Ñ‡∏Å‡∏•‡∏≤‡∏á", "‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å", "‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å"].includes(region)) return "‡∏†‡∏≤‡∏Ñ‡∏Å‡∏•‡∏≤‡∏á";
            return "‡∏†‡∏≤‡∏Ñ‡∏Å‡∏•‡∏≤‡∏á";
        }

        function checkThaiID(id) {
            if (id.length != 13) return false;
            for (i = 0, sum = 0; i < 12; i++) sum += parseFloat(id.charAt(i)) * (13 - i);
            if ((11 - sum % 11) % 10 != parseFloat(id.charAt(12))) return false;
            return true;
        }

        function validatePhone(phone) { const phoneRegex = /^0\d{9}$/; return phoneRegex.test(phone); }

        function getAdminProvince(email) {
            if (ADMIN_ROLES[email]) return ADMIN_ROLES[email];
            if (cachedData.length > 0) {
                const userRecord = cachedData.find(m => m.email === email && m.type !== 'feedback');
                if (userRecord) {
                    if (userRecord.admin_role) return userRecord.admin_role;
                    // Fallback: Check remarks for ROLE tag
                    const match = (userRecord.remarks || '').match(/{{ROLE:(.*?)}}/);
                    if (match) return match[1];
                }
            }
            return null;
        }

        // --- CHART JS UTILS & INITIALIZATION ---
        function formatLabel(str) {
            if (str.length <= 16) return str;
            const words = str.split(' ');
            const lines = [];
            let currentLine = words[0];
            for (let i = 1; i < words.length; i++) {
                if (currentLine.length + 1 + words[i].length <= 16) { currentLine += ' ' + words[i]; }
                else { lines.push(currentLine); currentLine = words[i]; }
            }
            lines.push(currentLine);
            return lines;
        }

        const commonTooltipConfig = {
            callbacks: {
                title: function (tooltipItems) {
                    const item = tooltipItems[0];
                    let label = item.chart.data.labels[item.dataIndex];
                    if (Array.isArray(label)) return label.join(' ');
                    return label;
                }
            }
        };

        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                tooltip: commonTooltipConfig,
                legend: { labels: { font: { family: 'Sarabun', size: 14 } } }
            },
            layout: { padding: 10 }
        };

        // Initialize Charts when content loaded
        window.addEventListener('DOMContentLoaded', () => {
            const provSelect = document.getElementById('inp-prov');
            const adminRoleSelect = document.getElementById('inp-admin-role');
            const postTargetSelect = document.getElementById('inp-post-target');

            PROVINCES.sort().forEach(p => {
                provSelect.innerHTML += `<option value="${p}">${p}</option>`;
                adminRoleSelect.innerHTML += `<option value="${p}">Admin ${p}</option>`;
                postTargetSelect.innerHTML += `<option value="${p}">${p}</option>`;
            });

            if (window.location.hash) {
                if (window.location.hash.includes('error=access_denied') && window.location.hash.includes('error_code=otp_expired')) {
                    alert("‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î '‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÉ‡∏´‡∏°‡πà");
                    window.location.hash = '';
                    switchView('auth');
                }
                else if (window.location.hash.includes('type=recovery')) {
                    isRecoveryMode = true;
                    switchView('reset');
                }
            }

            // --- CHART INITIALIZATION ---

            // 1. Ideology Radar
            const ctxIdeology = document.getElementById('ideologyChart').getContext('2d');
            new Chart(ctxIdeology, {
                type: 'radar',
                data: {
                    labels: ['‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡∏û‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ô‡∏≤', '‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ò‡∏¥‡∏õ‡πÑ‡∏ï‡∏¢', '‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£', '‡∏õ‡∏è‡∏¥‡∏£‡∏π‡∏õ‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢', '‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢'].map(formatLabel),
                    datasets: [{
                        label: '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢',
                        data: [10, 8, 9, 7, 6],
                        fill: true,
                        backgroundColor: 'rgba(255, 109, 0, 0.2)',
                        borderColor: '#FF6D00',
                        pointBackgroundColor: '#FF6D00',
                        pointBorderColor: '#fff'
                    }]
                },
                options: {
                    ...commonOptions,
                    scales: { r: { ticks: { display: false }, suggestedMin: 0, suggestedMax: 10 } }
                }
            });

            // 2. Monk Salary
            const ctxMonk = document.getElementById('monkSalaryChart').getContext('2d');
            new Chart(ctxMonk, {
                type: 'bar',
                data: {
                    labels: ['‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (1 ‡πÄ‡∏ó‡πà‡∏≤)', '‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà (2 ‡πÄ‡∏ó‡πà‡∏≤)'].map(formatLabel),
                    datasets: [{
                        label: '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡πÄ‡∏ó‡πà‡∏≤)',
                        data: [1, 2],
                        backgroundColor: ['#B0BEC5', '#FF6D00'],
                        borderRadius: 8
                    }]
                },
                options: {
                    ...commonOptions,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
                }
            });

            // 3. Social Security
            const ctxSocial = document.getElementById('socialSecurityChart').getContext('2d');
            new Chart(ctxSocial, {
                type: 'doughnut',
                data: {
                    labels: ['‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (5%)', '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÉ‡∏´‡∏°‡πà (1%)'].map(formatLabel),
                    datasets: [{
                        data: [5, 1],
                        backgroundColor: ['#ECEFF1', '#00B0FF'],
                        borderWidth: 2
                    }]
                },
                options: {
                    ...commonOptions,
                    cutout: '60%',
                    plugins: { legend: { position: 'bottom' } }
                }
            });

            // 4. Membership Fee
            const ctxMember = document.getElementById('membershipChart').getContext('2d');
            new Chart(ctxMember, {
                type: 'bar',
                data: {
                    labels: ['‡∏£‡∏≤‡∏¢‡∏õ‡∏µ (20‡∏ö.)', '‡∏ï‡∏•‡∏≠‡∏î‡∏ä‡∏µ‡∏û (200‡∏ö.)'].map(formatLabel),
                    datasets: [{
                        label: '‡∏Ñ‡πà‡∏≤‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏û‡∏£‡∏£‡∏Ñ (‡∏ö‡∏≤‡∏ó)',
                        data: [20, 200],
                        backgroundColor: ['#FFCC80', '#EF6C00'],
                        borderRadius: 6
                    }]
                },
                options: {
                    ...commonOptions,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });
        });

        function switchView(view) {
            ['landing', 'auth', 'dashboard', 'reset', 'member-center'].forEach(id => {
                const el = document.getElementById('view-' + id);
                if (el) el.classList.add('hidden');
            });
            const target = document.getElementById('view-' + view);
            if (target) target.classList.remove('hidden');
            window.scrollTo(0, 0);
            if (view === 'dashboard') {
                fetchData();
                renderExecutives(); // Render the executive team
            }
            if (view === 'member-center') {
                fetchData().then(() => {
                    renderNews();
                    renderKnowledge();
                });
                renderFeedbacks();
            }
        }

        function renderExecutives() {
            const container = document.getElementById('executive-container');
            container.innerHTML = '';
            executiveData.forEach(p => {
                container.innerHTML += `
                    <div class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition flex items-start gap-4">
                        <div class="bg-orange-50 text-orange-600 w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg border border-orange-100">
                            ${p.id}
                        </div>
                        <div>
                            <h4 class="font-bold text-gray-800 text-lg leading-tight">${p.name}</h4>
                            <div class="bg-orange-600 text-white text-xs px-2 py-1 rounded inline-block mt-2 mb-1">${p.pos}</div>
                            <p class="text-xs text-gray-500"><i class="fa-regular fa-calendar mr-1"></i> ‡πÄ‡∏£‡∏¥‡πà‡∏°: ${p.date}</p>
                        </div>
                    </div>
                `;
            });
        }

        sb.auth.onAuthStateChange((event, session) => {
            currentSession = session;
            if (event === 'PASSWORD_RECOVERY' || isRecoveryMode) {
                isRecoveryMode = true; switchView('reset');
            } else if (session) {
                document.getElementById('nav-guest').classList.add('hidden');
                document.getElementById('nav-user').classList.remove('hidden');
                document.getElementById('nav-user').classList.add('flex');
                const adminProv = getAdminProvince(session.user.email);
                const roleText = adminProv ? `<span class="text-orange-600 font-bold">(Admin ${adminProv === 'ALL' ? '‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á' : adminProv})</span>` : '<span class="text-green-600">(Member)</span>';
                document.getElementById('user-display').innerHTML = `${session.user.email} ${roleText}`;
                if (!isRecoveryMode && !document.getElementById('view-auth').classList.contains('hidden')) switchView('dashboard');
            } else {
                document.getElementById('nav-guest').classList.remove('hidden');
                document.getElementById('nav-user').classList.add('hidden');
                document.getElementById('nav-user').classList.remove('flex');
            }
        });

        async function handleAuth(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            try {
                if (isRegisterMode) {
                    const { error } = await sb.auth.signUp({ email, password: pass });
                    if (error) throw error;
                    alert("‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÅ‡∏≠‡∏û‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö");
                    switchAuthMode('login');
                } else {
                    const { error } = await sb.auth.signInWithPassword({ email, password: pass });
                    if (error) throw error;
                }
            } catch (err) { alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message); }
        }

        async function handleUpdatePassword(e) {
            e.preventDefault();
            const newPassword = document.getElementById('new-password').value;
            if (newPassword.length < 6) return alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£");
            try {
                const { data, error } = await sb.auth.updateUser({ password: newPassword });
                if (error) throw error;
                alert("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏û‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å");
                isRecoveryMode = false; window.location.hash = ''; switchView('dashboard');
            } catch (err) { alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ: " + err.message); }
        }

        async function handleForgotPassword() {
            const email = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô:");
            if (email) {
                try {
                    const { error } = await sb.auth.resetPasswordForEmail(email, { redirectTo: window.location.href });
                    if (error) throw error;
                    alert(`‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡∏ó‡∏µ‡πà ${email} ‡πÅ‡∏•‡πâ‡∏ß`);
                } catch (err) { alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÑ‡∏î‡πâ: " + err.message); }
            }
        }

        function parseInteractions(remarks) {
            const match = remarks.match(/{{INTERACT:({.*?})}}/s);
            if (match) { try { return JSON.parse(match[1]); } catch (e) { console.error("Parse Error", e); } }
            return { likes: [], neutrals: [], comments: [] };
        }

        async function updateInteraction(id, action, payload = null) {
            if (!currentSession) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô");
            const recordIndex = cachedData.findIndex(r => r.id == id);
            if (recordIndex === -1) return;
            const record = cachedData[recordIndex];
            let remarks = record.remarks || '';
            let interactData = parseInteractions(remarks);
            const userEmail = currentSession.user.email;
            if (action === 'like') {
                if (interactData.likes.includes(userEmail)) { interactData.likes = interactData.likes.filter(e => e !== userEmail); }
                else { interactData.likes.push(userEmail); interactData.neutrals = interactData.neutrals.filter(e => e !== userEmail); }
            } else if (action === 'neutral') {
                if (interactData.neutrals.includes(userEmail)) { interactData.neutrals = interactData.neutrals.filter(e => e !== userEmail); }
                else { interactData.neutrals.push(userEmail); interactData.likes = interactData.likes.filter(e => e !== userEmail); }
            } else if (action === 'comment') {
                if (!payload || !payload.trim()) return;
                interactData.comments.push({ user: userEmail, text: payload, time: new Date().toISOString() });
            }
            const newTag = `{{INTERACT:${JSON.stringify(interactData)}}}`;
            let newRemarks = remarks.replace(/{{INTERACT:({.*?})}}/s, '').trim();
            newRemarks = (newRemarks + ' ' + newTag).trim();
            cachedData[recordIndex].remarks = newRemarks;
            const containerId = document.getElementById('modal-news-reader').classList.contains('hidden') === false ? 'news-interaction-area' :
                (document.getElementById('modal-feedback-read').classList.contains('hidden') === false ? 'fb-interaction-area' : 'kn-interaction-area');
            renderInteractionUI(containerId, cachedData[recordIndex]);
            await sb.from('members').update({ remarks: newRemarks }).eq('id', id);
        }

        function renderInteractionUI(containerId, record) {
            const container = document.getElementById(containerId);
            if (!container) return;
            const data = parseInteractions(record.remarks || '');
            const likesCount = data.likes ? data.likes.length : 0;
            const neutralsCount = data.neutrals ? data.neutrals.length : 0;
            const comments = data.comments || [];
            const userEmail = currentSession ? currentSession.user.email : '';
            const isLiked = data.likes && data.likes.includes(userEmail);
            const isNeutral = data.neutrals && data.neutrals.includes(userEmail);
            let commentsHtml = comments.map(c => `
                <div class="mb-3">
                    <div class="flex items-center gap-2 mb-1">
                        <div class="w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center text-[10px] text-gray-600 font-bold">${c.user.substring(0, 2).toUpperCase()}</div>
                        <span class="text-xs font-bold text-gray-700">${c.user}</span>
                        <span class="text-[10px] text-gray-400">${new Date(c.time).toLocaleDateString('th-TH')}</span>
                    </div>
                    <div class="comment-bubble text-gray-800">${c.text}</div>
                </div>
            `).join('');
            if (comments.length === 0) commentsHtml = '<p class="text-gray-400 text-sm text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</p>';
            container.innerHTML = `
                <div class="flex items-center gap-4 mb-6">
                    <button onclick="updateInteraction('${record.id}', 'like')" class="flex items-center gap-2 px-4 py-2 rounded-full border transition ${isLiked ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}">
                        <i class="fa-solid fa-thumbs-up"></i> <span>‡∏ñ‡∏π‡∏Å‡πÉ‡∏à (${likesCount})</span>
                    </button>
                    <button onclick="updateInteraction('${record.id}', 'neutral')" class="flex items-center gap-2 px-4 py-2 rounded-full border transition ${isNeutral ? 'bg-gray-600 text-white border-gray-600' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}">
                        <i class="fa-solid fa-face-meh"></i> <span>‡πÄ‡∏â‡∏¢‡πÜ (${neutralsCount})</span>
                    </button>
                </div>
                <h5 class="font-bold text-gray-800 mb-4"><i class="fa-regular fa-comments mr-2"></i> ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô (${comments.length})</h5>
                <div class="max-h-64 overflow-y-auto mb-4 pr-2 reader-scroll">${commentsHtml}</div>
                <div class="flex gap-2">
                    <input id="comment-input-${record.id}" class="flex-grow p-2 border rounded-lg text-sm bg-gray-50 outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô...">
                    <button onclick="submitComment('${record.id}')" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-blue-700"><i class="fa-solid fa-paper-plane"></i></button>
                </div>
            `;
        }

        function submitComment(id) {
            const input = document.getElementById(`comment-input-${id}`);
            const text = input.value;
            if (!text) return;
            updateInteraction(id, 'comment', text).then(() => { if (input) input.value = ''; });
        }

        function renderKnowledge() {
            const list = document.getElementById('knowledge-list');
            const btnAdd = document.getElementById('btn-add-knowledge');
            list.innerHTML = '';
            const adminProv = currentSession ? getAdminProvince(currentSession.user.email) : null;
            if (adminProv) btnAdd.classList.remove('hidden'); else btnAdd.classList.add('hidden');
            const docs = cachedData.filter(d => d.type === 'knowledge');
            if (docs.length === 0) { list.innerHTML = `<li class="text-center text-gray-400 text-sm py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</li>`; return; }
            docs.forEach(doc => {
                let deleteBtn = adminProv ? `<i onclick="event.stopPropagation(); deleteData('${doc.id}')" class="fa-solid fa-trash text-gray-300 hover:text-red-500 cursor-pointer ml-3 p-2" title="‡∏•‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£"></i>` : '';
                const safeDoc = JSON.stringify(doc).replace(/"/g, '&quot;').replace(/'/g, "\\'");
                list.innerHTML += `
                <li onclick='openKnowledgeReader(${safeDoc})' class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-blue-50 transition group/item cursor-pointer">
                    <div class="flex items-center gap-3 flex-grow">
                        <i class="fa-solid fa-book text-blue-500 text-lg"></i>
                        <span class="text-gray-700 text-sm font-bold">${doc.name}</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-xs text-gray-400 mr-2">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π</span>
                        ${deleteBtn}
                    </div>
                </li>`;
            });
        }

        function openKnowledgeReader(doc) {
            document.getElementById('kn-read-title').innerText = doc.name;
            let filesHtml = '';
            let pdfUrl1 = '#', pdfUrl2 = '#';
            const match1 = (doc.remarks || '').match(/{{PDF1:(.*?)}}/);
            const match2 = (doc.remarks || '').match(/{{PDF2:(.*?)}}/);
            const oldMatch = (doc.remarks || '').match(/{{PDF:(.*?)}}/);
            if (match1) pdfUrl1 = match1[1]; else if (oldMatch) pdfUrl1 = oldMatch[1];
            if (match2) pdfUrl2 = match2[1];
            if (pdfUrl1 !== '#') filesHtml += `<a href="${pdfUrl1}" target="_blank" class="bg-white/20 text-white px-3 py-1 rounded text-xs hover:bg-white/30 border border-white/30"><i class="fa-solid fa-download mr-1"></i> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå 1</a>`;
            if (pdfUrl2 !== '#') filesHtml += `<a href="${pdfUrl2}" target="_blank" class="bg-white/20 text-white px-3 py-1 rounded text-xs hover:bg-white/30 border border-white/30"><i class="fa-solid fa-download mr-1"></i> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå 2</a>`;
            document.getElementById('kn-read-files').innerHTML = filesHtml;
            document.getElementById('modal-knowledge-read').classList.remove('hidden');
            document.getElementById('modal-knowledge-read').classList.add('flex');
            renderInteractionUI('kn-interaction-area', doc);
        }

        async function saveKnowledge(e) {
            e.preventDefault();
            if (!currentSession) return;
            const btn = document.getElementById('btn-know-save');
            const title = document.getElementById('inp-know-title').value;
            const file1 = document.getElementById('inp-know-file-1').files[0];
            const file2 = document.getElementById('inp-know-file-2').files[0];
            if (!file1 && !file2) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡πÑ‡∏ü‡∏•‡πå");
            btn.disabled = true; btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...";
            try {
                let remarks = "";
                if (file1) {
                    const ext1 = file1.name.split('.').pop();
                    const name1 = `know1_${Date.now()}_${Math.random().toString(36).substring(7)}.${ext1}`;
                    const { error: err1 } = await sb.storage.from('ThaiDev').upload(name1, file1, { cacheControl: '3600', upsert: false });
                    if (err1) throw err1;
                    const { data: data1 } = sb.storage.from('ThaiDev').getPublicUrl(name1);
                    remarks += `{{PDF1:${data1.publicUrl}}} `;
                }
                if (file2) {
                    const ext2 = file2.name.split('.').pop();
                    const name2 = `know2_${Date.now()}_${Math.random().toString(36).substring(7)}.${ext2}`;
                    const { error: err2 } = await sb.storage.from('ThaiDev').upload(name2, file2, { cacheControl: '3600', upsert: false });
                    if (err2) throw err2;
                    const { data: data2 } = sb.storage.from('ThaiDev').getPublicUrl(name2);
                    remarks += `{{PDF2:${data2.publicUrl}}}`;
                }
                const payload = {
                    name: title, type: 'knowledge', remarks: remarks.trim(),
                    email: currentSession.user.email, province: 'ALL', id_card: 'KNOWLEDGE', phone: '-'
                };
                const { error: dbError } = await sb.from('members').insert([payload]);
                if (dbError) throw dbError;
                alert("‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
                document.getElementById('modal-knowledge').classList.add('hidden');
                e.target.reset();
                fetchData().then(() => renderKnowledge());
            } catch (err) { alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message); }
            finally { btn.disabled = false; btn.innerText = "‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î"; }
        }

        function renderNews() {
            const container = document.getElementById('news-container');
            container.innerHTML = '';
            let userProv = null;
            let adminProv = null;
            if (currentSession) {
                const user = cachedData.find(m => m.email === currentSession.user.email);
                userProv = user ? user.province : null;
                adminProv = getAdminProvince(currentSession.user.email);
            }
            if (adminProv) document.getElementById('btn-create-post').classList.remove('hidden');
            else document.getElementById('btn-create-post').classList.add('hidden');
            const posts = cachedData.filter(m => m.type === 'post').filter(p => {
                return p.province === 'ALL' || (userProv && p.province === userProv) || adminProv;
            });
            if (posts.length === 0) {
                container.innerHTML = `<div class="col-span-full text-center py-12 text-gray-400 bg-white rounded-xl border border-dashed">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</div>`;
                return;
            }
            posts.forEach(p => {
                const date = new Date(p.created_at).toLocaleDateString('th-TH');
                let content = p.remarks || '';
                let imgUrl = 'https://via.placeholder.com/400x225?text=No+Image';
                const imgMatch = content.match(/{{IMG:(.*?)}}/);
                if (imgMatch) { imgUrl = imgMatch[1]; content = content.replace(/{{IMG:(.*?)}}/g, ''); }
                content = content.replace(/{{INTERACT:({.*?})}}/s, '');
                let controls = '';
                const isOwner = p.email === currentSession?.user?.email;
                if (adminProv === 'ALL' || isOwner) {
                    controls = `
                        <div class="absolute bottom-2 right-2 flex gap-1 z-20">
                            <button onclick="event.stopPropagation(); openPostModal('edit', ${JSON.stringify(p).replace(/"/g, '&quot;')})" class="bg-white/90 p-2 rounded-full hover:bg-white text-blue-600 shadow border action-btn"><i class="fa-solid fa-pen"></i></button>
                            <button onclick="event.stopPropagation(); deleteData('${p.id}')" class="bg-white/90 p-2 rounded-full hover:bg-white text-red-600 shadow border action-btn"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    `;
                }
                const badge = p.province === 'ALL'
                    ? '<span class="bg-blue-600 text-white text-xs px-2 py-1 rounded absolute top-2 left-2 z-10">‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á</span>'
                    : `<span class="bg-orange-600 text-white text-xs px-2 py-1 rounded absolute top-2 left-2 z-10">${p.province}</span>`;
                const safePostObj = JSON.stringify(p).replace(/"/g, '&quot;');
                container.innerHTML += `
                    <div class="bg-white rounded-xl shadow-sm border overflow-hidden relative group hover:shadow-lg transition cursor-pointer" onclick="openNewsReader(${safePostObj})">
                        ${badge}
                        <img src="${imgUrl}" class="w-full h-48 object-cover aspect-video relative z-0">
                        ${controls}
                        <div class="p-4 relative z-0">
                            <div class="text-xs text-gray-400 mb-2"><i class="fa-regular fa-calendar mr-1"></i> ${date}</div>
                            <h4 class="font-bold text-gray-800 text-lg mb-2 line-clamp-2">${p.name}</h4>
                            <p class="text-sm text-gray-600 line-clamp-3 mb-4">${content}</p>
                            <button class="text-orange-600 text-sm font-bold hover:underline action-btn">‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</button>
                        </div>
                    </div>
                `;
            });
        }

        function openNewsReader(post) {
            let content = post.remarks || '';
            const imgMatch = content.match(/{{IMG:(.*?)}}/);
            let imgUrl = null;
            if (imgMatch) { imgUrl = imgMatch[1]; content = content.replace(/{{IMG:(.*?)}}/g, ''); }
            content = content.replace(/{{INTERACT:({.*?})}}/s, '');
            document.getElementById('news-reader-title').innerText = post.name;
            document.getElementById('news-reader-date').innerText = new Date(post.created_at).toLocaleDateString('th-TH');
            document.getElementById('news-reader-content').innerText = content;
            const imgContainer = document.getElementById('news-reader-img-container');
            const img = document.getElementById('news-reader-img');
            if (imgUrl) { imgContainer.classList.remove('hidden'); img.src = imgUrl; }
            else { imgContainer.classList.add('hidden'); }
            document.getElementById('modal-news-reader').classList.remove('hidden');
            document.getElementById('modal-news-reader').classList.add('flex');
            renderInteractionUI('news-interaction-area', post);
        }

        window.openPostModal = (mode, record = null) => {
            const modal = document.getElementById('modal-post');
            const form = document.getElementById('postForm');
            const title = document.getElementById('modal-post-title');
            const targetWrapper = document.getElementById('post-target-wrapper');
            const imgPreview = document.getElementById('post-img-preview');
            form.reset();
            imgPreview.classList.add('hidden');
            document.getElementById('post-id').value = '';
            const adminProv = getAdminProvince(currentSession.user.email);
            if (adminProv === 'ALL') targetWrapper.classList.remove('hidden');
            else targetWrapper.classList.add('hidden');
            if (mode === 'edit' && record) {
                title.innerText = "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß";
                document.getElementById('post-id').value = record.id;
                document.getElementById('inp-post-title').value = record.name;
                let content = record.remarks || '';
                const imgMatch = content.match(/{{IMG:(.*?)}}/);
                if (imgMatch) { imgPreview.classList.remove('hidden'); imgPreview.querySelector('img').src = imgMatch[1]; content = content.replace(/{{IMG:(.*?)}}/g, ''); }
                content = content.replace(/{{INTERACT:({.*?})}}/s, '');
                document.getElementById('inp-post-content').value = content.trim();
                if (adminProv === 'ALL') document.getElementById('inp-post-target').value = record.province;
            } else { title.innerText = "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏°‡πà"; }
            modal.classList.remove('hidden'); modal.classList.add('flex');
        };

        window.closePostModal = () => document.getElementById('modal-post').classList.add('hidden');

        async function savePost(e) {
            e.preventDefault();
            const btn = document.getElementById('btn-post-save');
            btn.disabled = true; btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå...";
            const recordId = document.getElementById('post-id').value;
            const title = document.getElementById('inp-post-title').value;
            const content = document.getElementById('inp-post-content').value;
            const fileInput = document.getElementById('inp-post-img');
            const adminProv = getAdminProvince(currentSession.user.email);
            let targetProv = adminProv === 'ALL' ? document.getElementById('inp-post-target').value : adminProv;
            let imgUrl = null;
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const ext = file.name.split('.').pop();
                const name = `news_${Date.now()}_${Math.random().toString(36).substring(7)}.${ext}`;
                const { error, data } = await sb.storage.from('ThaiDev').upload(name, file);
                if (error) { alert("Error: " + error.message); btn.disabled = false; return; }
                const { data: urlData } = sb.storage.from('ThaiDev').getPublicUrl(name);
                imgUrl = urlData.publicUrl;
            } else if (recordId) {
                const oldRec = cachedData.find(r => r.id == recordId);
                const oldMatch = (oldRec.remarks || '').match(/{{IMG:(.*?)}}/);
                if (oldMatch) imgUrl = oldMatch[1];
            }
            let finalRemarks = content;
            if (imgUrl) finalRemarks += ` {{IMG:${imgUrl}}}`;
            if (recordId) {
                const oldRec = cachedData.find(r => r.id == recordId);
                const interactMatch = (oldRec.remarks || '').match(/{{INTERACT:({.*?})}}/s);
                if (interactMatch) finalRemarks += ` ${interactMatch[0]}`;
            }
            const payload = {
                name: title, remarks: finalRemarks, type: 'post', province: targetProv,
                email: currentSession.user.email, id_card: 'POST', phone: '-'
            };
            let result;
            if (recordId) result = await sb.from('members').update(payload).eq('id', recordId);
            else result = await sb.from('members').insert([payload]);
            if (result.error) alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + result.error.message);
            else { closePostModal(); alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πà‡∏≤‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"); fetchData(); }
            btn.disabled = false; btn.innerText = "‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡πà‡∏≤‡∏ß";
        }

        async function handleFeedbackSubmit(e) {
            e.preventDefault();
            if (!currentSession) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô"); return switchView('auth'); }
            const btn = document.getElementById('btn-feedback-submit');
            btn.disabled = true; btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';
            const type = document.getElementById('fb-type').value;
            const topic = document.getElementById('fb-topic').value;
            const detail = document.getElementById('fb-detail').value;
            const payload = {
                name: topic, remarks: detail, type: 'feedback', email: currentSession.user.email, province: type, id_card: 'FEEDBACK', phone: '-'
            };
            const { error } = await sb.from('members').insert([payload]);
            if (error) alert("‡∏™‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + error.message);
            else {
                alert("‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß\n‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î");
                e.target.reset();
                renderFeedbacks();
            }
            btn.disabled = false; btn.innerHTML = '<i class="fa-solid fa-paper-plane mr-2"></i> ‡∏™‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á';
        }

        async function renderFeedbacks() {
            const tbody = document.getElementById('feedback-table-body');
            tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>';
            const { data, error } = await sb.from('members').select('*').eq('type', 'feedback').order('created_at', { ascending: false }).limit(10);
            tbody.innerHTML = '';
            if (data && data.length > 0) {
                data.forEach(f => {
                    const date = new Date(f.created_at).toLocaleDateString('th-TH');
                    let isResolved = (f.remarks || '').includes('{{STATUS:RESOLVED}}');
                    // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô Ticket
                    let statusBadge = isResolved
                        ? '<span class="bg-green-100 text-green-700 px-2 py-1 rounded text-xs border border-green-200 font-bold"><i class="fa-solid fa-check-circle mr-1"></i>‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</span>'
                        : '<span class="bg-orange-50 text-orange-700 px-2 py-1 rounded text-xs border border-orange-200 font-bold"><i class="fa-regular fa-clock mr-1"></i>‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</span>';

                    let typeTxt = f.province === 'suggestion' ? '<span class="text-blue-600"><i class="fa-regular fa-lightbulb"></i> ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</span>'
                        : (f.province === 'complaint' ? '<span class="text-red-600"><i class="fa-solid fa-triangle-exclamation"></i> ‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>'
                            : '<span class="text-gray-600"><i class="fa-solid fa-circle-question"></i> ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°</span>');

                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á Ticket ID ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏à‡∏≤‡∏Å ID ‡∏à‡∏£‡∏¥‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏π‡∏î‡∏µ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô
                    const ticketId = '#' + f.id.substring(0, 6).toUpperCase();
                    const safeFbObj = JSON.stringify(f).replace(/"/g, '&quot;');

                    tbody.innerHTML += `
                        <tr class="hover:bg-gray-50 transition border-b cursor-pointer group" onclick="openFeedbackReader(${safeFbObj})">
                            <td class="px-6 py-4 text-gray-400 text-xs font-mono font-bold">${ticketId}</td>
                            <td class="px-6 py-4 text-gray-500 text-xs">${date}</td>
                            <td class="px-6 py-4 text-sm whitespace-nowrap">${typeTxt}</td>
                            <td class="px-6 py-4 font-medium text-gray-800 text-sm group-hover:text-blue-600 truncate max-w-xs">${f.name}</td>
                            <td class="px-6 py-4 text-right">${statusBadge}</td>
                        </tr>`;
                });
            } else { tbody.innerHTML = `<tr><td colspan="5" class="text-center py-4 text-gray-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td></tr>`; }
        }

        function openFeedbackReader(fb) {
            document.getElementById('fb-read-topic').innerText = fb.name;
            document.getElementById('fb-read-type').innerText = fb.province === 'suggestion' ? '‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞' : (fb.province === 'complaint' ? '‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô' : '‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°');
            document.getElementById('fb-read-date').innerText = new Date(fb.created_at).toLocaleDateString('th-TH');
            let detail = (fb.remarks || '').replace('{{STATUS:RESOLVED}}', '');
            detail = detail.replace(/{{INTERACT:({.*?})}}/s, '').trim();
            document.getElementById('fb-read-detail').innerText = detail;
            let isResolved = (fb.remarks || '').includes('{{STATUS:RESOLVED}}');
            document.getElementById('fb-read-status').innerHTML = isResolved
                ? '<span class="text-green-600 font-bold"><i class="fa-solid fa-circle-check"></i> ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span>'
                : '<span class="text-orange-500 font-bold"><i class="fa-regular fa-clock"></i> ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</span>';
            document.getElementById('modal-feedback-read').classList.remove('hidden');
            document.getElementById('modal-feedback-read').classList.add('flex');
            renderInteractionUI('fb-interaction-area', fb);
        }

        function switchAuthMode(mode) {
            isRegisterMode = mode === 'register';
            document.querySelector('#view-auth h2').innerText = isRegisterMode ? "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÅ‡∏≠‡∏û" : "‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
            document.querySelector('#view-auth button').innerText = isRegisterMode ? "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô" : "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö";
        }

        async function handleLogout() {
            try { await sb.auth.signOut(); } catch (err) { console.error(err); }
            switchView('landing'); currentSession = null;
            document.getElementById('nav-guest').classList.remove('hidden');
            document.getElementById('nav-user').classList.add('hidden');
            document.getElementById('nav-user').classList.remove('flex');
        }

        async function handlePublicAction(type) {
            if (!currentSession) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô"); switchView('auth'); return; }
            const email = currentSession.user.email;
            const adminProv = getAdminProvince(email);
            if (adminProv) { openModal(type, null); return; }
            let existingData = null;
            if (cachedData.length > 0) {
                const found = cachedData.find(m => m.email === email && m.type !== 'feedback');
                if (found) existingData = found;
            } else { existingData = { email: email }; }
            openModal(type, existingData);
        }

        function filterDashboard(type) {
            activeFilter = type;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.dataset.filter === type) { btn.classList.remove('bg-white', 'border', 'text-gray-600'); btn.classList.add('bg-gray-200', 'text-gray-700'); }
                else { btn.classList.add('bg-white', 'border', 'text-gray-600'); btn.classList.remove('bg-gray-200', 'text-gray-700'); }
            });
            handleSearch();
        }

        function handleSearch() {
            const txt = document.getElementById('inp-search').value.toLowerCase();
            let baseData = cachedData;
            if (activeFilter !== 'all') baseData = cachedData.filter(m => m.type === activeFilter);
            if (!txt) filteredData = [...baseData];
            else {
                filteredData = baseData.filter(m =>
                    (m.name || '').toLowerCase().includes(txt) || (m.member_id || '').toLowerCase().includes(txt) ||
                    (m.id_card || '').includes(txt) || (m.phone || '').includes(txt) || (m.remarks || '').toLowerCase().includes(txt)
                );
            }
            renderTable(filteredData);
        }

        // --- SEPARATED LOGIC FOR FEEDBACK MANAGEMENT ---

        window.openFeedbackManageModal = (record) => {
            const modal = document.getElementById('modal-feedback-manage');

            document.getElementById('fb-manage-id').value = record.id;
            document.getElementById('fb-manage-type').innerText = record.province.toUpperCase();
            document.getElementById('fb-manage-date').innerText = new Date(record.created_at).toLocaleDateString('th-TH');
            document.getElementById('fb-manage-topic').innerText = record.name;
            document.getElementById('fb-manage-by').innerText = record.email;

            // Handle Detail (Remove system tags)
            let detail = (record.remarks || '').replace('{{STATUS:RESOLVED}}', '').replace(/{{INTERACT:({.*?})}}/s, '').trim();
            document.getElementById('fb-manage-detail').innerText = detail;

            // Handle Status
            const isResolved = (record.remarks || '').includes('{{STATUS:RESOLVED}}');
            document.getElementById('fb-manage-status').value = isResolved ? 'RESOLVED' : 'PENDING';

            modal.classList.remove('hidden'); modal.classList.add('flex');
        }

        async function saveFeedbackStatus(e) {
            e.preventDefault();
            const btn = e.target;
            btn.disabled = true; btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";

            try {
                const id = document.getElementById('fb-manage-id').value;
                const newStatus = document.getElementById('fb-manage-status').value;

                // Fetch current remarks to preserve other data
                const record = cachedData.find(r => r.id == id);
                if (!record) throw new Error("Record not found");

                let remarks = record.remarks || '';

                // Remove old status tag
                remarks = remarks.replace('{{STATUS:RESOLVED}}', '').trim();

                // Add new status tag if resolved
                if (newStatus === 'RESOLVED') {
                    remarks = remarks + ' {{STATUS:RESOLVED}}';
                }

                const { error } = await sb.from('members').update({ remarks: remarks }).eq('id', id);
                if (error) throw error;

                alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
                document.getElementById('modal-feedback-manage').classList.add('hidden');
                fetchData();

            } catch (err) {
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message);
            } finally {
                btn.disabled = false; btn.innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞";
            }
        }

        // --- EXISTING MODAL LOGIC (ONLY FOR MEMBERS/CANDIDATES NOW) ---

        window.openModal = (type, record = null) => {
            // ** SAFETY CHECK: If type is feedback, use the new modal instead **
            if (type === 'edit' && record && typeof record === 'string') {
                const r = cachedData.find(d => d.id == record);
                if (r && r.type === 'feedback') {
                    openFeedbackManageModal(r);
                    return;
                }
            } else if (type === 'edit' && record && record.type === 'feedback') {
                openFeedbackManageModal(record);
                return;
            }

            // Normal Member Logic Continues...
            if (typeof record === 'string') { record = cachedData.find(r => r.id == record); }
            const modal = document.getElementById('modal-form');
            const title = document.getElementById('modal-title');
            const saveBtn = document.getElementById('btn-save');
            const recordIdInput = document.getElementById('record-id');
            const form = document.getElementById('memberForm');
            const adminTools = document.getElementById('admin-tools');
            const adminRoleSetting = document.getElementById('admin-role-setting');
            form.reset();
            document.getElementById('id-error').classList.add('hidden');
            document.getElementById('phone-error').classList.add('hidden');
            recordIdInput.value = '';
            isEditMode = false;
            const adminProv = currentSession && getAdminProvince(currentSession.user.email);
            if (adminProv) {
                adminTools.classList.remove('hidden');
                if (adminProv === 'ALL') adminRoleSetting.classList.remove('hidden'); else adminRoleSetting.classList.add('hidden');
            } else { adminTools.classList.add('hidden'); }
            if (record && record.id) {
                isEditMode = true;
                recordIdInput.value = record.id;
                if (type === 'edit') type = record.type;
            }
            title.innerHTML = isEditMode ? '<i class="fa-solid fa-pen-to-square"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å'
                : (type === 'candidate' ? '<i class="fa-solid fa-user-tie"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‡∏™.‡∏™.' : '<i class="fa-solid fa-user-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏û‡∏£‡∏£‡∏Ñ');

            if (record) {
                document.getElementById('inp-member-id').value = record.member_id || '';
                document.getElementById('inp-name').value = record.name || '';
                document.getElementById('inp-dob').value = record.dob || '';
                document.getElementById('inp-id').value = record.id_card || '';
                document.getElementById('inp-email').value = record.email || '';
                document.getElementById('inp-phone').value = record.phone || '';
                document.getElementById('inp-line').value = record.line_id || '';
                document.getElementById('inp-addr').value = record.address || '';
                document.getElementById('inp-tambon').value = record.tambon || '';
                document.getElementById('inp-district').value = record.district || '';
                document.getElementById('inp-prov').value = record.province || '';
                document.getElementById('inp-zip').value = record.zip || '';
                document.getElementById('inp-recommender').value = record.recommender_name || '';
                document.getElementById('inp-start-date').value = record.start_date || '';
                // Checkbox PDPA doesn't need to be filled from DB as it's a submission consent, not stored state usually, but let's reset it
                document.getElementById('inp-pdpa').checked = false;

                let remarks = record.remarks || '';
                let adminRole = record.admin_role || '';
                const roleMatch = remarks.match(/{{ROLE:(.*?)}}/);
                if (roleMatch) adminRole = roleMatch[1];
                document.getElementById('inp-admin-role').value = adminRole;

                if (remarks.includes(OLD_DATA_TAG)) { document.getElementById('inp-is-old').checked = true; remarks = remarks.replace(OLD_DATA_TAG, ''); }
                else { document.getElementById('inp-is-old').checked = false; }

                remarks = remarks.replace(/{{MID:(.*?)}}/g, '').replace(/{{ROLE:(.*?)}}/g, '')
                    .replace(STATUS_APPROVED_TAG, '').replace('{{STATUS:RESOLVED}}', '')
                    .replace(/{{START_DATE:(.*?)}}/g, '').replace(/{{INTERACT:({.*?})}}/s, '')
                    .replace(/{{DOC1:(.*?)}}/g, '').replace(/{{PDF:(.*?)}}/g, '').replace(/{{DOC2:(.*?)}}/g, '').trim();
                document.getElementById('inp-remarks').value = remarks;
            } else if (adminProv) {
                document.getElementById('inp-email').value = '';
                document.getElementById('inp-is-old').checked = false;
                document.getElementById('inp-admin-role').value = '';
                document.getElementById('inp-pdpa').checked = false;
            }
            const provSelect = document.getElementById('inp-prov');
            provSelect.disabled = false;
            if (adminProv && adminProv !== 'ALL') { provSelect.value = adminProv; provSelect.disabled = true; }
            saveBtn.innerText = isEditMode ? '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
            document.getElementById('inp-type').value = type;
            modal.classList.remove('hidden'); modal.classList.add('flex');
        };

        window.closeModal = () => document.getElementById('modal-form').classList.add('hidden');

        async function saveData(e) {
            e.preventDefault();
            const saveBtn = document.getElementById('btn-save');
            saveBtn.disabled = true; saveBtn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";

            // PDPA Check (Explicit check in JS though HTML required handles it)
            if (!document.getElementById('inp-pdpa').checked) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (PDPA)");
                saveBtn.disabled = false; saveBtn.innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
                return;
            }

            try {
                const recordId = document.getElementById('record-id').value;
                const type = document.getElementById('inp-type').value;

                // Double Check: If somehow type is feedback, stop here
                if (type === 'feedback') throw new Error("Please use the Feedback Manager to edit feedback items.");

                const name = document.getElementById('inp-name').value;
                const email = document.getElementById('inp-email').value;
                const phone = document.getElementById('inp-phone').value;
                const idCard = document.getElementById('inp-id').value;
                const province = document.getElementById('inp-prov').value;

                const adminProv = getAdminProvince(currentSession.user.email);
                if (!adminProv && !checkThaiID(idCard)) {
                    document.getElementById('id-error').classList.remove('hidden');
                    throw new Error("‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
                } else {
                    document.getElementById('id-error').classList.add('hidden');
                }

                if (!adminProv && !validatePhone(phone)) {
                    document.getElementById('phone-error').classList.remove('hidden');
                    throw new Error("‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
                } else {
                    document.getElementById('phone-error').classList.add('hidden');
                }

                let remarks = document.getElementById('inp-remarks').value;
                if (document.getElementById('inp-is-old').checked) remarks += ` ${OLD_DATA_TAG}`;
                const adminRoleVal = document.getElementById('inp-admin-role').value;
                if (adminRoleVal) remarks += ` {{ROLE:${adminRoleVal}}}`;

                if (recordId) {
                    const oldRec = cachedData.find(r => r.id == recordId);
                    if (oldRec) {
                        if (oldRec.remarks.includes(STATUS_APPROVED_TAG)) remarks += ` ${STATUS_APPROVED_TAG}`;
                        const interactMatch = (oldRec.remarks || '').match(/{{INTERACT:({.*?})}}/s);
                        if (interactMatch) remarks += ` ${interactMatch[0]}`;
                    }
                }

                const payload = {
                    member_id: document.getElementById('inp-member-id').value,
                    name: name,
                    dob: document.getElementById('inp-dob').value,
                    id_card: idCard,
                    email: email,
                    phone: phone,
                    line_id: document.getElementById('inp-line').value,
                    address: document.getElementById('inp-addr').value,
                    tambon: document.getElementById('inp-tambon').value,
                    district: document.getElementById('inp-district').value,
                    province: province,
                    zip: document.getElementById('inp-zip').value,
                    recommender_name: document.getElementById('inp-recommender').value,
                    type: type,
                    remarks: remarks,
                    start_date: document.getElementById('inp-start-date').value
                };

                let result;
                if (recordId) {
                    result = await sb.from('members').update(payload).eq('id', recordId);
                } else {
                    if (!adminProv) payload.email = currentSession.user.email;
                    result = await sb.from('members').insert([payload]);
                }

                if (result.error) throw result.error;

                alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                closeModal();
                fetchData();

            } catch (err) {
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message);
            } finally {
                saveBtn.disabled = false;
                saveBtn.innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
            }
        }

        async function fetchData() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('table-body').innerHTML = '';

            const adminProv = currentSession ? getAdminProvince(currentSession.user.email) : null;
            let query = sb.from('members').select('*');

            // Permission Logic
            if (!adminProv) {
                // Regular User: See own data + public posts
                query = query.or(`email.eq.${currentSession.user.email},type.eq.post,type.eq.knowledge`);
            } else if (adminProv !== 'ALL') {
                // Provincial Admin: See all data in province + public posts
                query = query.or(`province.eq.${adminProv},type.eq.post,type.eq.knowledge,province.eq.ALL`);
            }

            const { data, error } = await query;

            document.getElementById('loading').classList.add('hidden');
            if (error) {
                console.error(error);
                return;
            }

            cachedData = data || [];

            // Calculate Stats
            const users = new Set(cachedData.map(m => m.email)).size;
            const members = cachedData.filter(m => m.type === 'member').length;
            const candidates = cachedData.filter(m => m.type === 'candidate').length;

            document.getElementById('stat-users').innerText = users;
            document.getElementById('stat-total').innerText = members;
            document.getElementById('stat-candidate').innerText = candidates;

            // Region Stats
            const regionStats = {};
            cachedData.filter(m => m.type === 'member').forEach(m => {
                const region = mapToMainRegion(getRegion(m.province));
                regionStats[region] = (regionStats[region] || 0) + 1;
            });

            const regionHTML = Object.entries(regionStats).map(([reg, count]) => `
                <div class="bg-gray-50 p-3 rounded-lg border border-gray-200">
                    <span class="block text-xs text-gray-500">${reg}</span>
                    <span class="block text-xl font-bold text-gray-800">${count}</span>
                </div>
            `).join('');
            document.getElementById('region-stats-container').innerHTML = regionHTML || '<div class="text-xs text-gray-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';

            handleSearch(); // Render Table
        }

        function sortTable(key) {
            if (sortConfig.key === key) sortConfig.direction *= -1;
            else { sortConfig.key = key; sortConfig.direction = 1; }

            filteredData.sort((a, b) => {
                let valA = a[key] || '';
                let valB = b[key] || '';
                return valA.toString().localeCompare(valB.toString()) * sortConfig.direction;
            });
            renderTable(filteredData);

            // Update Icons
            document.querySelectorAll('th i').forEach(i => i.className = 'fa-solid fa-sort ml-1');
            const activeTh = document.querySelector(`th[onclick="sortTable('${key}')"] i`);
            if (activeTh) activeTh.className = sortConfig.direction === 1 ? 'fa-solid fa-sort-up ml-1' : 'fa-solid fa-sort-down ml-1';
        }

        function renderTable(data) {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';

            if (data.length === 0) {
                document.getElementById('empty-state').classList.remove('hidden');
                return;
            } else {
                document.getElementById('empty-state').classList.add('hidden');
            }

            const adminProv = getAdminProvince(currentSession.user.email);

            data.forEach(item => {
                // Skip if filtering hides it
                if (activeFilter !== 'all' && item.type !== activeFilter) return;

                // For Feedback items, use special rendering in the "Manage" column
                let manageBtns = '';
                const isOwner = item.email === currentSession.user.email;

                if (adminProv || isOwner) {
                    const canEdit = adminProv === 'ALL' || (adminProv && item.province === adminProv) || isOwner;

                    if (canEdit) {
                        manageBtns = `
                            <button onclick="openModal('edit', '${item.id}')" class="text-blue-600 hover:text-blue-800 mr-2"><i class="fa-solid fa-pen-to-square"></i></button>
                            <button onclick="deleteData('${item.id}')" class="text-red-600 hover:text-red-800"><i class="fa-solid fa-trash"></i></button>
                        `;
                    }
                }

                // Status Logic
                let status = '<span class="px-2 py-1 rounded bg-gray-100 text-gray-500 text-xs">‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</span>';
                if (item.type === 'member') status = '<span class="px-2 py-1 rounded bg-green-100 text-green-700 text-xs">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span>';
                if (item.type === 'candidate') status = '<span class="px-2 py-1 rounded bg-orange-100 text-orange-700 text-xs">‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‡∏™.‡∏™.</span>';
                if (item.type === 'feedback') {
                    const isResolved = (item.remarks || '').includes('{{STATUS:RESOLVED}}');
                    status = isResolved
                        ? '<span class="px-2 py-1 rounded bg-green-100 text-green-700 text-xs font-bold">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</span>'
                        : '<span class="px-2 py-1 rounded bg-orange-100 text-orange-700 text-xs font-bold">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</span>';
                }
                if (item.remarks && item.remarks.includes(OLD_DATA_TAG)) status += ' <span class="text-xs text-gray-400">(‡πÄ‡∏î‡∏¥‡∏°)</span>';

                // Format Date
                const date = new Date(item.start_date || item.created_at).toLocaleDateString('th-TH');

                tbody.innerHTML += `
                    <tr class="hover:bg-gray-50 border-b">
                        <td class="px-6 py-4 font-mono text-xs">${item.member_id || '-'}</td>
                        <td class="px-6 py-4">${date}</td>
                        <td class="px-6 py-4 font-medium text-gray-900">${item.name}</td>
                        <td class="px-6 py-4">${status}</td>
                        <td class="px-6 py-4 text-xs">
                            <div class="flex flex-col gap-1">
                                <span><i class="fa-solid fa-phone w-4"></i> ${item.phone || '-'}</span>
                                <span><i class="fa-brands fa-line w-4"></i> ${item.line_id || '-'}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-xs truncate max-w-xs" title="${item.address || ''} ${item.tambon || ''} ${item.district || ''}">
                            ${item.address || '-'} ${item.tambon || ''} ${item.district || ''}
                        </td>
                        <td class="px-6 py-4 text-xs">${item.province}</td>
                        <td class="px-6 py-4 text-right">
                            ${manageBtns}
                        </td>
                    </tr>
                `;
            });
        }

        async function deleteData(id) {
            if (!confirm("‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ")) return;
            try {
                const { error } = await sb.from('members').delete().eq('id', id);
                if (error) throw error;
                alert("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
                fetchData();
            } catch (err) {
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö: " + err.message);
            }
        }

        // Initial fetch handled by auth state change or view switch
    </script>
</body>

</html>
